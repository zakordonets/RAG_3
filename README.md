# RAG-ัะธััะตะผะฐ ะดะปั edna Chat Center

ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฟะพะผะพัะฝะธะบ ะฝะฐ ะฑะฐะทะต RAG (Retrieval-Augmented Generation) ะดะปั ัะตัะฝะธัะตัะบะพะน ะฟะพะดะดะตัะถะบะธ ะฟัะพะดัะบัะฐ edna Chat Center. ะกะธััะตะผะฐ ะธัะฟะพะปัะทัะตั ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ ะฟะพ ะดะพะบัะผะตะฝัะฐัะธะธ ะธ ะณะตะฝะตัะฐัะธั ะพัะฒะตัะพะฒ ั ะฟะพะผะพััั LLM.

## ๐ v4.0.0 - ะะดะธะฝะฐั ะฐััะธัะตะบัััะฐ ะธะฝะดะตะบัะฐัะธะธ ะทะฐะฒะตััะตะฝะฐ!

**ะกะธััะตะผะฐ ะฟะตัะตะฒะตะดะตะฝะฐ ะฝะฐ ัะฝะธัะธัะธัะพะฒะฐะฝะฝัะน DAG ะฟะฐะนะฟะปะฐะนะฝ:**
- ๐๏ธ **ะะดะธะฝัะน DAG ะฟะฐะนะฟะปะฐะนะฝ** - ัะฝะธัะธัะธัะพะฒะฐะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะฒัะตั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั
- ๐ **Source Adapters** - ะฐะดะฐะฟัะตัั ะดะปั Docusaurus, ะฒะตะฑ-ัะฐะนัะพะฒ ะธ ะดััะณะธั ะธััะพัะฝะธะบะพะฒ
- ๐งฉ **Pipeline Steps** - ะผะพะดัะปัะฝัะต ัะฐะณะธ ะพะฑัะฐะฑะพัะบะธ (Parse โ Normalize โ Chunk โ Embed โ Index)
- ๐ **Unified State Manager** - ะตะดะธะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ัะพััะพัะฝะธะตะผ ะดะพะบัะผะตะฝัะพะฒ
- ๐งน **Normalizers** - ะฟะปะฐะณะธะฝั ะฝะพัะผะฐะปะธะทะฐัะธะธ ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ะบะพะฝัะตะฝัะฐ
- ๐ฆ **Qdrant Writer** - ะตะดะธะฝัะน ะฟะธัะฐัะตะปั ะฒ ะฒะตะบัะพัะฝัั ะฑะฐะทั ะดะฐะฝะฝัั
- ๐ง **ะฃะฟัะพัะตะฝะฝะฐั ััััะบัััะฐ** - ัะฑัะฐะฝะพ 13 ะปะธัะฝะธั ัะฐะนะปะพะฒ, ะพััะฐะฒะปะตะฝั ัะพะปัะบะพ ะฐะบัะธะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั
- ๐งช **ะะพะปะฝะพะต ะฟะพะบัััะธะต ัะตััะฐะผะธ** - 101 ัะตัั ะดะปั ะฝะพะฒะพะน ะฐััะธัะตะบัััั
- ๐ **ะฃะปัััะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ** - ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะฑะฐััะธ ะธ ะพะฑัะฐะฑะพัะบะฐ
- ๐๏ธ **ะฃัััะฐะฝะตะฝะธะต ะดัะฑะปะธัะพะฒะฐะฝะธั** - ะตะดะธะฝัะน ะบะพะด ะดะปั ะฒัะตั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั

**๐ ะะพะดัะพะฑะฝะพััะธ:** [ะััะธัะตะบัััะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั](docs/architecture.md) | [ะัะบะพะฒะพะดััะฒะพ ะฟะพ ะผะธะณัะฐัะธะธ](docs/migration_guide.md)

## ๐ ะะพะทะผะพะถะฝะพััะธ

- **ะะฝะพะณะพะบะฐะฝะฐะปัะฝะพััั**: ะะพะดะดะตัะถะบะฐ Telegram ะธ ะณะพัะพะฒะฝะพััั ะบ ะดััะณะธะผ ะบะฐะฝะฐะปะฐะผ
- **ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ**: ะะพะผะฑะธะฝะฐัะธั dense ะธ sparse ัะผะฑะตะดะดะธะฝะณะพะฒ ั RRF fusion (100% ะฟะพะบัััะธะต sparse ะฒะตะบัะพัะฐะผะธ)
- **ะกะตะผะฐะฝัะธัะตัะบะพะต chunking**: ะฃะปัััะตะฝะฝะพะต ัะฐะทะฑะธะตะฝะธะต ัะตะบััะฐ ะฝะฐ ะพัะฝะพะฒะต ััะพะดััะฒะฐ
- **GPU-ััะบะพัะตะฝะธะต**: Unified BGE-M3 embeddings ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะฒัะฑะพัะพะผ ัััะฐัะตะณะธะธ (ONNX+DirectML, BGE-M3+CPU, Hybrid)
- **Sparse ะฒะตะบัะพัั**: ะะพะบะฐะปัะฝะฐั ะณะตะฝะตัะฐัะธั sparse ัะผะฑะตะดะดะธะฝะณะพะฒ ัะตัะตะท BGE-M3 (ะฑะตะท ะฒะฝะตัะฝะตะณะพ ัะตัะฒะธัะฐ)
- **ะฃะผะฝะฐั ะผะฐัััััะธะทะฐัะธั**: ะะฒัะพะผะฐัะธัะตัะบะธะน fallback ะผะตะถะดั LLM ะฟัะพะฒะฐะนะดะตัะฐะผะธ
- **ะัะฐัะธะฒะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต**: MarkdownV2 ัะตัะตะท `telegramify-markdown` v0.5.1 ั ัะผะพะดะทะธ ะธ ััััะบัััะธัะพะฒะฐะฝะฝัะผะธ ะพัะฒะตัะฐะผะธ
- **Redis ะบะตัะธัะพะฒะฐะฝะธะต**: ะััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพะต ะบะตัะธัะพะฒะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ ะธ ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ
- **ะะธะฑะบะฐั ัะธััะตะผะฐ ะธััะพัะฝะธะบะพะฒ**: ะะพะดะดะตัะถะบะฐ ะฒะตะฑ-ัะฐะนัะพะฒ, ะปะพะบะฐะปัะฝัั ะฟะฐะฟะพะบ, API ะดะพะบัะผะตะฝัะฐัะธะธ, ะฑะปะพะณะพะฒ, FAQ
- **ะะพะดัะปัะฝัะต ะบัะฐัะปะตัั**: ะะตะณะบะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะธะฟะพะฒ ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั
- **Production-ready**: Comprehensive error handling, Circuit Breaker, ะผะตััะธะบะธ Prometheus
- **ะะตะทะพะฟะฐัะฝะพััั**: ะะพะปะฝะฐั ะฒะฐะปะธะดะฐัะธั, ัะฐะฝะธัะธะทะฐัะธั ะธ ะผะพะฝะธัะพัะธะฝะณ ะฑะตะทะพะฟะฐัะฝะพััะธ
- **Rate Limiting**: ะะฐัะธัะฐ ะพั ะทะปะพัะฟะพััะตะฑะปะตะฝะธะน ั burst protection
- **ะะพะฝะธัะพัะธะฝะณ**: Prometheus ะผะตััะธะบะธ ะธ ะดะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- **ะะฐะดะตะถะฝะพััั**: Graceful degradation ะธ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
- **Phase 2: RAGAS Quality System**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะตะฝะบะฐ ะบะฐัะตััะฒะฐ ั RAGAS ะผะตััะธะบะฐะผะธ (Faithfulness, Context Precision, Answer Relevancy)
- **ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ัะธะดะฑะตะบ**: Inline ะบะฝะพะฟะบะธ ะฒ Telegram ะดะปั ะพัะตะฝะบะธ ะพัะฒะตัะพะฒ
- **Quality Analytics**: REST API ะดะปั ะฐะฝะฐะปะธะทะฐ ะบะฐัะตััะฒะฐ ะธ ััะตะฝะดะพะฒ
- **Prometheus ะผะตััะธะบะธ**: ะะพะฝะธัะพัะธะฝะณ ะบะฐัะตััะฒะฐ ัะตัะตะท Grafana dashboard

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Telegram Bot  โ    โ   Web Interface โ    โ   Other Channelsโ
โ   (Long Polling)โ    โ   (Future)      โ    โ   (Future)      โ
โโโโโโโโโโโฌโโโโโโโโ    โโโโโโโโโโโฌโโโโโโโโ    โโโโโโโโโโโฌโโโโโโโโ
          โ                      โ                      โ
          โโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ      Channel Adapters     โ
                    โ   (Telegram, Web, etc.)   โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ        Core API           โ
                    โ    (Flask + RESTful)      โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ     Query Processing      โ
                    โ (Entity Extraction, etc.) โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ      Embeddings          โ
                    โ (BGE-M3 Unified + Redis) โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ      Vector Search        โ
                    โ (Qdrant + Dense + Sparse) โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ       Reranking          โ
                    โ   (BGE-reranker-v2-m3)   โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ      LLM Router          โ
                    โ (YandexGPT, GPT-5, etc.) โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

### ะกะธััะตะผะฝัะต ััะตะฑะพะฒะฐะฝะธั
- Python 3.11+
- Docker (ะดะปั Qdrant ะธ Redis)
- 8GB+ RAM (ัะตะบะพะผะตะฝะดัะตััั)
- 2GB+ ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ

### API ะบะปััะธ
- YandexGPT API ะบะปัั
- Deepseek API ะบะปัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- GPT-5 API ะบะปัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- Telegram Bot Token

## ๐๏ธ ะฃััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั
```bash
git clone <repository-url>
cd RAG_2
```

### 2. ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

### 3. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
```bash
pip install -r requirements.txt
```

### 4. ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั
```bash
cp env.example .env
# ะััะตะดะฐะบัะธััะนัะต .env ัะฐะนะป ั ะฒะฐัะธะผะธ API ะบะปััะฐะผะธ
```

### 5. ะะฐะฟััะบ ัะตัะฒะธัะพะฒ

#### Qdrant (ะฒะตะบัะพัะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั)
```bash
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant
```

#### Redis (ะบะตัะธัะพะฒะฐะฝะธะต)
```bash
docker run -p 6379:6379 redis:7-alpine
```

ะะปะธ ะธัะฟะพะปัะทัะนัะต Docker Compose ะดะปั ะทะฐะฟััะบะฐ ะฒัะตั ัะตัะฒะธัะพะฒ:
```bash
docker-compose up -d redis qdrant
```

### 6. ะะฝะธัะธะฐะปะธะทะฐัะธั ะฑะฐะทั ะดะฐะฝะฝัั
```bash
python scripts/init_qdrant.py
```

### 7. ะะฝะดะตะบัะฐัะธั ะดะพะบัะผะตะฝัะฐัะธะธ (v4.0.0)

#### ะะดะธะฝัะน ะฟะฐะนะฟะปะฐะนะฝ ะธะฝะดะตะบัะฐัะธะธ (ัะตะบะพะผะตะฝะดัะตััั)
```bash
# ะะฝะดะตะบัะฐัะธั Docusaurus ะดะพะบัะผะตะฝัะฐัะธะธ
python -m ingestion.run --source docusaurus --docs-root "C:\CC_RAG\docs"

# ะะฝะดะตะบัะฐัะธั ะฒะตะฑ-ัะฐะนัะฐ
python -m ingestion.run --source website --seed-urls "https://example.com"

# ะก ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะผ ัะฐะนะปะพะผ
python -m ingestion.run --source docusaurus --config ingestion/config.yaml
```

#### ะะพะฝัะธะณััะฐัะธั ะธะฝะดะตะบัะฐัะธะธ
```yaml
# ingestion/config.yaml
global:
  qdrant:
    url: "http://localhost:6333"
    collection: "docs_chatcenter"
  embeddings:
    backend: "auto"
    batch_size: 2
    use_sparse: true

sources:
  docusaurus:
    enabled: true
    docs_root: "C:\\CC_RAG\\docs"
    site_base_url: "https://docs-chatcenter.edna.ru"
    site_docs_prefix: "/docs"
    chunk:
      max_tokens: 300
      overlap_tokens: 60
```

#### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะธััะพัะฝะธะบะฐ ะดะฐะฝะฝัั
```bash
# 1. ะกะพะทะดะฐะนัะต ะฝะพะฒัะน SourceAdapter ะฒ ingestion/adapters/
# 2. ะะพะฑะฐะฒััะต ะฝะพัะผะฐะปะธะทะฐัะพัั ะฒ ingestion/normalizers/
# 3. ะะฑะฝะพะฒะธัะต ingestion/run.py ะดะปั ะฟะพะดะดะตัะถะบะธ ะฝะพะฒะพะณะพ ะธััะพัะฝะธะบะฐ
# 4. ะะพะฑะฐะฒััะต ัะตััั ะฒ tests/
print(f'Found {len(results)} pages')
"
```

### 8. ะะฐะฟััะบ ัะธััะตะผั

#### Flask API
```bash
python wsgi.py
```

#### Telegram Bot
```bash
# ะกะฟะพัะพะฑ 1: ะััะผะพะน ะทะฐะฟััะบ (ัะตะบะพะผะตะฝะดัะตััั)
python adapters/telegram/polling.py

# ะกะฟะพัะพะฑ 2: ะงะตัะตะท batch-ัะบัะธะฟั (Windows)
start_telegram_bot.bat

# ะกะฟะพัะพะฑ 3: ะงะตัะตะท PowerShell ัะบัะธะฟั
.\start_telegram_bot.ps1
```

ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะพัะฒะตัะพะฒ ะฒัะฟะพะปะฝัะตััั ะฑะธะฑะปะธะพัะตะบะพะน `telegramify-markdown`, ะพัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน โ ั `parse_mode=MarkdownV2`. ะ ะปะพะณะฐั Core API ัะธะบัะธััะตััั, ะบะฐะบะพะน ะผะตัะพะด ะฑะธะฑะปะธะพัะตะบะธ ะฟัะธะผะตะฝัะฝ (markdownify/telegramify) ะธ ะฟัะตะดะฟัะพัะผะพัั ัะตะทัะปััะฐัะฐ, ััะพ ะฟะพะผะพะณะฐะตั ะดะธะฐะณะฝะพััะธัะพะฒะฐัั ะพัะธะฑะบะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธั (400: can't parse entities).

ะัะธ ะพัะธะฑะบะต ะพัะฟัะฐะฒะบะธ ะฒ MarkdownV2 ััะฐะฑะฐััะฒะฐะตั fallback โ ะฟะตัะตััะปะบะฐ ะฑะตะท ัะพัะผะฐัะธัะพะฒะฐะฝะธั.

ะัะปะธ ะฒะธะดะธัะต ะปะธัะฝะธะต ะพะฑัะฐัะฝัะต ัะปััะธ ะฒ ัะพะพะฑัะตะฝะธะธ, ัะฑะตะดะธัะตัั, ััะพ ะธัะฟะพะปัะทัะตััั ะธะผะตะฝะฝะพ `MarkdownV2` ะธ ัะตะบัั ะฝะต ะฟัะพัะพะดะธั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะต ัะบัะฐะฝะธัะพะฒะฐะฝะธะต ะฒะฝะต `telegramify-markdown`.

### ะะฟัะธะผะธะทะฐัะธั reranker

ะะตัะฐะฝะถะธัะพะฒะฐะฝะธะต ะบะฐะฝะดะธะดะฐัะพะฒ (BAAI/bge-reranker-v2-m3) ะฒัะฟะพะปะฝะตะฝะพ ั ะฟะฐะบะตัะฝะพะน ะพะฑัะฐะฑะพัะบะพะน:

- batch_size: 20
- max_length: 384 (ััะตัะตะฝะธะต ัะตะบััะฐ ะฟะตัะตะด ัะพะบะตะฝะธะทะฐัะธะตะน)

ะญัะพ ัะฝะธะถะฐะตั ะฝะฐะบะปะฐะดะฝัะต ัะฐััะพะดั ัะพะบะตะฝะธะทะฐัะธะธ/ะธะฝัะตัะตะฝัะฐ ะฝะฐ CPU. ะะตะฐะปะธะทะฐัะธั โ `app/services/rerank.py`, ะฒะบะปััะตะฝะพ ะฒ ะพัะบะตัััะฐัะพัะต `app/services/orchestrator.py`.

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะัะฝะพะฒะฝัะต ะฝะฐัััะพะนะบะธ (.env)

```env
# Qdrant
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=your_api_key

# LLM ะฟัะพะฒะฐะนะดะตัั
YANDEX_API_KEY=your_yandex_key
DEEPSEEK_API_KEY=your_deepseek_key
GPT5_API_KEY=your_gpt5_key

# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token

# BGE-M3 Unified Embeddings
EMBEDDINGS_BACKEND=auto  # auto|onnx|bge|hybrid
EMBEDDING_DEVICE=auto    # auto|cpu|cuda|directml
EMBEDDING_MAX_LENGTH_QUERY=512
EMBEDDING_MAX_LENGTH_DOC=1024
EMBEDDING_BATCH_SIZE=16
USE_SPARSE=true

# Legacy (ะดะปั ัะพะฒะผะตััะธะผะพััะธ)
EMBEDDING_MODEL_NAME=BAAI/bge-m3
EMBEDDING_DIM=1024

# ะะพะธัะบ
HYBRID_DENSE_WEIGHT=0.7
HYBRID_SPARSE_WEIGHT=0.3
RERANK_TOP_N=10

# Phase 2: RAGAS Quality System
ENABLE_RAGAS_EVALUATION=true
RAGAS_EVALUATION_SAMPLE_RATE=1.0
QUALITY_DB_ENABLED=true
DATABASE_URL=sqlite+aiosqlite:///data/quality_interactions.db
ENABLE_QUALITY_METRICS=true
```

### BGE-M3 Unified Embeddings

ะกะธััะตะผะฐ ะธัะฟะพะปัะทัะตั ะตะดะธะฝัะน BGE-M3 ัะตัะฒะธั ะดะปั ะณะตะฝะตัะฐัะธะธ dense ะธ sparse ัะผะฑะตะดะดะธะฝะณะพะฒ ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะฒัะฑะพัะพะผ ะพะฟัะธะผะฐะปัะฝะพะน ัััะฐัะตะณะธะธ.

#### ะกััะฐัะตะณะธะธ ัะผะฑะตะดะดะธะฝะณะพะฒ

**`EMBEDDINGS_BACKEND=auto`** (ัะตะบะพะผะตะฝะดัะตััั) - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั:
- **NVIDIA GPU**: `bge` - BGE-M3 ั CUDA ััะบะพัะตะฝะธะตะผ
- **AMD GPU (Windows)**: `hybrid` - Dense ัะตัะตะท ONNX+DirectML, Sparse ัะตัะตะท BGE-M3+CPU
- **CPU only**: `onnx` - ONNX Runtime ะดะปั ะบะพะฝัะธััะตะฝัะฝะพััะธ

**`EMBEDDINGS_BACKEND=onnx`** - ONNX Runtime:
- โ Dense embeddings ัะตัะตะท ONNX+DirectML (Windows/AMD)
- โ Sparse embeddings ะฝะต ะฟะพะดะดะตัะถะธะฒะฐัััั
- ๐ฏ ะัััะธะน ะฒัะฑะพั ะดะปั Windows/AMD GPU

**`EMBEDDINGS_BACKEND=bge`** - ะะฐัะธะฒะฝัะน BGE-M3:
- โ Dense + Sparse embeddings
- โ CUDA ััะบะพัะตะฝะธะต (NVIDIA)
- โ DirectML ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตััั
- ๐ฏ ะัััะธะน ะฒัะฑะพั ะดะปั NVIDIA GPU

**`EMBEDDINGS_BACKEND=hybrid`** - ะะธะฑัะธะดะฝัะน ะฟะพะดัะพะด:
- โ Dense ัะตัะตะท ONNX+DirectML (GPU)
- โ Sparse ัะตัะตะท BGE-M3+CPU
- ๐ฏ ะะฟัะธะผะฐะปัะฝะพ ะดะปั Windows/AMD

#### ONNX Runtime ะบะพะฝัะธะณััะฐัะธั

ะะตัะตะบะปััะฐัะตะปั ONNX ะฟัะพะฒะฐะนะดะตัะฐ (`ONNX_PROVIDER`):
- `auto` โ DmlExecutionProvider โ CPU fallback (ะฟะพ ัะผะพะปัะฐะฝะธั)
- `dml` โ ะฟัะธะฝัะดะธัะตะปัะฝะพ DirectML (ะตัะปะธ ะดะพัััะฟะตะฝ)
- `cpu` โ ะฟัะธะฝัะดะธัะตะปัะฝะพ CPU

#### ะัะธะผะตัั ะทะฐะฟััะบะฐ

```powershell
# ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ัััะฐัะตะณะธะธ
$env:EMBEDDINGS_BACKEND="auto"; python scripts\test_auto_strategy.py

# ะัะธะฝัะดะธัะตะปัะฝะพ hybrid ะดะปั Windows/AMD
$env:EMBEDDINGS_BACKEND="hybrid"; $env:ONNX_PROVIDER="dml"

# ะะตะฝัะผะฐัะบ ะฒัะตั ัััะฐัะตะณะธะน
python scripts\benchmark_embeddings_strategies.py
```

#### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

ะะตะทัะปััะฐัั ะฑะตะฝัะผะฐัะบะฐ ะฝะฐ AMD Radeon RX 6700 XT (Windows):

| ะกััะฐัะตะณะธั | ะกัะตะดะฝัั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั | Dense | Sparse | GPU |
|-----------|---------------------------|--------|--------|-----|
| **Hybrid** | **0.098s** โก | ONNX+DirectML | BGE-M3+CPU | โ |
| ONNX | 0.232s | ONNX+DirectML | โ | โ |
| BGE | 0.314s | BGE-M3+CPU | BGE-M3+CPU | โ |

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
- ๐ **Windows/AMD**: `EMBEDDINGS_BACKEND=hybrid` ะดะปั ะปัััะตะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- ๐ **Linux/NVIDIA**: `EMBEDDINGS_BACKEND=bge` ะดะปั ะฟะพะปะฝะพะณะพ GPU ััะบะพัะตะฝะธั
- ๐ **CPU only**: `EMBEDDINGS_BACKEND=onnx` ะดะปั ััะฐะฑะธะปัะฝะพััะธ
- โ๏ธ **ะะฒัะพะผะฐัะธัะตัะบะธ**: `EMBEDDINGS_BACKEND=auto` (ัะตะบะพะผะตะฝะดัะตััั)

### ะะฐัััะพะนะบะฐ ะบัะฐัะปะตัะฐ

```env
CRAWL_START_URL=https://docs-chatcenter.edna.ru/
CRAWL_STRATEGY=jina  # jina, browser, http
CRAWL_TIMEOUT_S=30
CRAWL_MAX_PAGES=1000
```

## ๐ API Endpoints

### Chat API
- `POST /v1/chat/query` - ะะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะฒะฐะปะธะดะฐัะธะตะน

### Quality API (Phase 2)
- `GET /v1/admin/quality/stats` - ะกัะฐัะธััะธะบะฐ ะบะฐัะตััะฒะฐ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- `GET /v1/admin/quality/interactions` - ะกะฟะธัะพะบ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน ั ะผะตััะธะบะฐะผะธ
- `GET /v1/admin/quality/trends` - ะขัะตะฝะดั ะบะฐัะตััะฒะฐ ะฟะพ ะฒัะตะผะตะฝะธ
- `GET /v1/admin/quality/correlation` - ะะพััะตะปััะธะพะฝะฝัะน ะฐะฝะฐะปะธะท ะผะตััะธะบ
- `POST /v1/admin/quality/feedback` - ะะพะฑะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ัะธะดะฑะตะบะฐ

### Admin API
- `GET /v1/admin/health` - ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะธััะตะผั ั Circuit Breakers
- `POST /v1/admin/reindex` - ะะตัะตะธะฝะดะตะบัะฐัะธั ะดะพะบัะผะตะฝัะฐัะธะธ

### API ะะพะบัะผะตะฝัะฐัะธั
- `GET /apidocs` - Swagger UI ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั API
- `GET /apispec_1.json` - OpenAPI 2.0 ัะฟะตัะธัะธะบะฐัะธั ะฒ JSON ัะพัะผะฐัะต

### ะะพะฝะธัะพัะธะฝะณ
- `GET /v1/admin/metrics` - ะะตััะธะบะธ Prometheus ะฒ JSON
- `GET /v1/admin/metrics/raw` - ะกัััะต ะผะตััะธะบะธ Prometheus
- `GET /v1/admin/circuit-breakers` - ะกะพััะพัะฝะธะต Circuit Breakers
- `GET /v1/admin/cache` - ะกัะฐัะธััะธะบะฐ ะบััะฐ

### Rate Limiting
- `GET /v1/admin/rate-limiter` - ะกะพััะพัะฝะธะต Rate Limiter
- `GET /v1/admin/rate-limiter/<user_id>` - ะกะพััะพัะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
- `POST /v1/admin/rate-limiter/<user_id>/reset` - ะกะฑัะพั ะปะธะผะธัะพะฒ

### ะะตะทะพะฟะฐัะฝะพััั
- `GET /v1/admin/security` - ะกัะฐัะธััะธะบะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ
- `GET /v1/admin/security/user/<user_id>` - ะกะพััะพัะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
- `POST /v1/admin/security/user/<user_id>/block` - ะะปะพะบะธัะพะฒะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต (v4.0.0)

### ะะดะธะฝะฐั ะฐััะธัะตะบัััะฐ ัะตััะพะฒ

ะกะธััะตะผะฐ ะฒะบะปััะฐะตั 101 ัะตัั ะดะปั ะฝะพะฒะพะน ะตะดะธะฝะพะน ะฐััะธัะตะบัััั:

```bash
# ะัะต ัะตััั ะฝะพะฒะพะน ะฐััะธัะตะบัััั
python -m pytest tests/test_unified_* tests/test_docusaurus_* -v

# ะขะตััั ะฐะดะฐะฟัะตัะพะฒ ะธััะพัะฝะธะบะพะฒ
python -m pytest tests/test_unified_adapters.py -v

# ะขะตััั ะฟะฐะนะฟะปะฐะนะฝะฐ
python -m pytest tests/test_unified_pipeline.py -v

# ะขะตััั ะธะฝะดะตะบัะฐัะธะธ
python -m pytest tests/test_unified_indexing.py -v

# ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
python -m pytest tests/test_unified_integration.py -v

# ะขะตััั Docusaurus ะบะพะผะฟะพะฝะตะฝัะพะฒ
python -m pytest tests/test_docusaurus_* -v
```

### ะะพะบัััะธะต ัะตััะฐะผะธ

**โ ะะพะปะฝะพัััั ะฟะพะบัััะพ:**
- Source Adapters (Docusaurus, Website)
- Pipeline DAG ะธ ัะฐะณะธ
- Qdrant Writer ะธ ะธะฝะดะตะบัะฐัะธั
- Utils ััะฝะบัะธะธ (clean, links, pathing)
- Docusaurus crawler

**๐ ะกัะฐัะธััะธะบะฐ:**
- **101 ัะตัั** ะดะปั ะฝะพะฒะพะน ะฐััะธัะตะบัััั
- **58 ัะตััะพะฒ** ะพัะฝะพะฒะฝะพะน ะฐััะธัะตะบัััั
- **43 ัะตััะฐ** Docusaurus ะบะพะผะฟะพะฝะตะฝัะพะฒ
- **0 ะพัะธะฑะพะบ** ะฒ ัะตััะฐั

### ะะฒัะพัะตััั (ะะตะบะพะผะตะฝะดัะตััั)

```bash
# ะัะต ะฑัััััะต ัะตััั
make test-fast

# ะขะพะปัะบะพ unit ัะตััั
make test-unit

# ะัะต ัะตััั (ะฒะบะปััะฐั ะผะตะดะปะตะฝะฝัะต)
make test

# ะขะตััั ั ะฟะพะบัััะธะตะผ ะบะพะดะฐ
make test-coverage

# ะะธะฝัะธะฝะณ ะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธะต
make lint
make format
```

**ะะพัััะฟะฝัะต ะบะพะผะฐะฝะดั:**
- `make test-unit` - ัะพะปัะบะพ unit ัะตััั
- `make test-integration` - ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
- `make test-e2e` - end-to-end ัะตััั
- `make test-slow` - ะผะตะดะปะตะฝะฝัะต ัะตััั
- `make test-fast` - ะฑัััััะต ัะตััั (ะฑะตะท ะผะตะดะปะตะฝะฝัั)

### End-to-End Pipeline ะขะตััั

```bash
# ะะพะปะฝัะน ัะตัั pipeline ะพั ะธะทะฒะปะตัะตะฝะธั ะดะพ ะทะฐะฟะธัะธ ะฒ Qdrant
pytest tests/test_end_to_end_pipeline.py -v

# ะะฐะฟััะบ ัะตัะตะท pytest
python scripts/run_tests.py --type fast --verbose
```

**ะะพะบััะฒะฐะตะผัะต ััะตะฝะฐัะธะธ:**
- โ ะะทะฒะปะตัะตะฝะธะต ะธ chunking ะดะพะบัะผะตะฝัะพะฒ
- โ ะะดะฐะฟัะธะฒะฝัะต ัััะฐัะตะณะธะธ chunking
- โ ะะฝะดะตะบัะฐัะธั ั enhanced metadata
- โ ะะฐะปะธะดะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ
- โ ะกะธััะตะผะฐ ะฟะปะฐะณะธะฝะพะฒ ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั
- โ ะะตััะธะบะธ ะบะฐัะตััะฒะฐ chunking

### CI/CD Pipeline

ะะฒัะพะผะฐัะธัะตัะบะธะต ัะตััั ะทะฐะฟััะบะฐัััั ะฟัะธ:
- Push ะฒ ะฒะตัะบะธ `main`, `develop`
- ะกะพะทะดะฐะฝะธะธ Pull Request

**GitHub Actions:**
- ะะพะดะดะตัะถะบะฐ Python 3.9, 3.10, 3.11
- ะกะตัะฒะธัั Redis ะธ Qdrant ะดะปั ัะตััะพะฒ
- ะะธะฝัะธะฝะณ ะธ ะฟัะพะฒะตัะบะฐ ัะธะฟะพะฒ
- ะะตะฝะตัะฐัะธั ะพััะตัะพะฒ ะพ ะฟะพะบัััะธะธ

### Phase 2: RAGAS Quality System
```bash
# ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั Phase 2
$env:PYTHONPATH=(Get-Location).Path; pytest tests/test_integration_phase2.py -v

# ะขะตััั ั ะพัะบะปััะตะฝะฝัะผ RAGAS (ะฑัััััะต)
$env:RAGAS_EVALUATION_SAMPLE_RATE="0"; pytest tests/test_integration_phase2.py -v

# ะัะพะฒะตัะบะฐ Quality API
curl http://localhost:9000/v1/admin/quality/stats
curl http://localhost:9000/v1/admin/quality/interactions
```

### ะขะตัั API
```bash
curl -X POST http://localhost:9000/v1/chat/query \
  -H "Content-Type: application/json" \
  -d '{"message": "ะะฐะบ ะฝะฐัััะพะธัั ะผะฐัััััะธะทะฐัะธั?"}'
```

### ะะฝัะตัะฐะบัะธะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั API
```bash
# ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต
http://localhost:9000/apidocs

# ะะปะธ ะฟะพะปััะธัะต OpenAPI ัะฟะตัะธัะธะบะฐัะธั
curl http://localhost:9000/apispec_1.json
```

### ะขะตัั Telegram ะฑะพัะฐ
1. ะะฐะนะดะธัะต ะฑะพัะฐ ะฒ Telegram: `@edna_cc_bot`
2. ะัะฟัะฐะฒััะต ัะพะพะฑัะตะฝะธะต: "ะัะธะฒะตั"
3. ะัะพะฒะตัััะต ะพัะฒะตั

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ๐ ะัััััะน ััะฐัั ะผะพะฝะธัะพัะธะฝะณะฐ
```bash
# ะะฐะฟััะบ Grafana + Prometheus
.\start_monitoring.ps1

# ะะพัััะฟ ะบ ะธะฝัะตััะตะนัะฐะผ
# Prometheus: http://localhost:9090
# Grafana: http://localhost:8080 (admin/admin123)
```

### ะะพะณะธ
ะกะธััะตะผะฐ ะธัะฟะพะปัะทัะตั `loguru` ะดะปั ััััะบัััะธัะพะฒะฐะฝะฝะพะณะพ ะปะพะณะธัะพะฒะฐะฝะธั:
- ะัะตะผั ะพะฑัะฐะฑะพัะบะธ ะบะฐะถะดะพะณะพ ััะฐะฟะฐ
- ะัะธะฑะบะธ ะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธั ั ะบะพะฝัะตะบััะพะผ
- ะกัะฐัะธััะธะบะฐ ะทะฐะฟัะพัะพะฒ ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

### Prometheus ะผะตััะธะบะธ
- `rag_queries_total` - ะบะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ ะฟะพ ะบะฐะฝะฐะปะฐะผ ะธ ััะฐัััะฐะผ
- `rag_query_duration_seconds` - ะดะปะธัะตะปัะฝะพััั ััะฐะฟะพะฒ ะพะฑัะฐะฑะพัะบะธ
- `rag_embedding_duration_seconds` - ะฒัะตะผั ัะพะทะดะฐะฝะธั ัะผะฑะตะดะดะธะฝะณะพะฒ
- `rag_search_duration_seconds` - ะฒัะตะผั ะฟะพะธัะบะฐ
- `rag_llm_duration_seconds` - ะฒัะตะผั ะณะตะฝะตัะฐัะธะธ LLM
- `rag_cache_hits_total` - ะฟะพะฟะฐะดะฐะฝะธั ะฒ ะบัั
- `rag_errors_total` - ะพัะธะฑะบะธ ะฟะพ ัะธะฟะฐะผ ะธ ะบะพะผะฟะพะฝะตะฝัะฐะผ

### Grafana ะดะฐัะฑะพัะดั
- **RAG System Overview** - ะพัะฝะพะฒะฝะพะน ะดะฐัะฑะพัะด ั ะบะปััะตะฒัะผะธ ะผะตััะธะบะฐะผะธ
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต
- ะะธะทัะฐะปะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ, ะบััะฐ, ะพัะธะฑะพะบ

### HTTP ัะตัะฒะตั ะผะตััะธะบ
- ะะพัั: 9002
- Endpoint: `http://localhost:9002/metrics`
- ะกะพะฒะผะตััะธะผะพััั ั Grafana ะธ ะดััะณะธะผะธ ัะธััะตะผะฐะผะธ ะผะพะฝะธัะพัะธะฝะณะฐ

### ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
- [MONITORING_README.md](MONITORING_README.md) - ะบัะฐัะบะพะต ััะบะพะฒะพะดััะฒะพ
- [docs/monitoring_setup.md](docs/monitoring_setup.md) - ะฟะพะดัะพะฑะฝะฐั ะฝะฐัััะพะนะบะฐ

## ๐ Redis ะบะตัะธัะพะฒะฐะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะฐั ะฝะฐัััะพะนะบะฐ
Redis ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธัะฟะพะปัะทัะตััั ะดะปั ะบะตัะธัะพะฒะฐะฝะธั:
- **ะญะผะฑะตะดะดะธะฝะณะพะฒ** - ะทะฝะฐัะธัะตะปัะฝะพะต ััะบะพัะตะฝะธะต ะฟะพะฒัะพัะฝัั ะทะฐะฟัะพัะพะฒ
- **ะะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ** - ะฑัััััะต ะพัะฒะตัั ะฝะฐ ะฟะพัะพะถะธะต ะฒะพะฟัะพัั
- **LLM ะพัะฒะตัะพะฒ** - ัะบะพะฝะพะผะธั API ะฒัะทะพะฒะพะฒ

### ะัััััะน ะทะฐะฟััะบ Redis
```bash
# ะงะตัะตะท Docker (ัะตะบะพะผะตะฝะดัะตััั)
docker run -p 6379:6379 redis:7-alpine

# ะะปะธ ัะตัะตะท Docker Compose
docker-compose up -d redis
```

### ะะฐัััะพะนะบะฐ ะฒ .env
```env
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=  # ะััะฐะฒััะต ะฟััััะผ ะดะปั ัะฐะฑะพัั ะฑะตะท ะฟะฐัะพะปั
```

### ะะพะฝะธัะพัะธะฝะณ Redis
ะกัะฐัะธััะธะบะฐ ะดะพัััะฟะฝะฐ ะฒ health endpoint:
```bash
curl http://localhost:9000/v1/admin/health
```

ะะพะบะฐะทัะฒะฐะตั:
- ะะพะดะบะปััะตะฝะฝัะต ะบะปะธะตะฝัั
- ะะพะฟะฐะดะฐะฝะธั/ะฟัะพะผะฐัะธ ะบะตัะฐ
- ะัะฟะพะปัะทัะตะผะฐั ะฟะฐะผััั
- ะขะธะฟ ะบะตัะฐ (redis/memory)

## ๐ ะะตัะตะธะฝะดะตะบัะฐัะธั ั ัะปัััะตะฝะฝัะผะธ ะทะฐะณะพะปะพะฒะบะฐะผะธ

### ๐ ะะตะบะพะผะตะฝะดัะตะผัะน ัะฟะพัะพะฑ (ะตะดะธะฝัะน ะผะพะดัะปั)

ะะปั ะฟะพะปััะตะฝะธั ะผะฐะบัะธะผะฐะปัะฝะพะณะพ ะบะฐัะตััะฒะฐ ะฟะพะธัะบะฐ ั ัะปัััะตะฝะฝัะผะธ ะทะฐะณะพะปะพะฒะบะฐะผะธ ะธัะฟะพะปัะทัะตััั ะตะดะธะฝัะน production ะผะพะดัะปั:

```bash
# ะัะพะฒะตัะธัั ััะฐััั ัะธััะตะผั
$env:PYTHONPATH = "$PWD"; python scripts/indexer.py status

# ะะพะปะฝะฐั ะฟะตัะตะธะฝะดะตะบัะฐัะธั (ัะตะบะพะผะตะฝะดัะตััั)
$env:PYTHONPATH = "$PWD"; python scripts/indexer.py reindex --mode full

# ะขะตััะพะฒะฐั ะฟะตัะตะธะฝะดะตะบัะฐัะธั (ัะพะปัะบะพ 5 ัััะฐะฝะธั)
$env:PYTHONPATH = "$PWD"; python scripts/indexer.py reindex --mode full --max-pages 5
```

### โจ ะฃะปัััะตะฝะธั ะทะฐะณะพะปะพะฒะบะพะฒ

ะกะธััะตะผะฐ ัะตะฟะตัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธะฒะฝัะต ะทะฐะณะพะปะพะฒะบะธ ะธะท Jina Reader:

**ะะพ:** `Sv Threadcontrol Threadtransfer` (ะธะท URL)
**ะะพัะปะต:** `ะะฝะดะธะบะฐัะพัั ะฒ ััะตะดะฐั` (ะธะท ะบะพะฝัะตะฝัะฐ) โจ

### โ๏ธ ะะปััะตัะฝะฐัะธะฒะฝัะต ัะฟะพัะพะฑั

```bash
# ะงะตัะตะท ะผะพะดัะปั pipeline
$env:PYTHONPATH = "$PWD"; python -m ingestion.pipeline

# ะงะตัะตะท API (ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต)
curl -X POST http://localhost:9000/v1/admin/reindex

# ะะฝะบัะตะผะตะฝัะฐะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต (ัะพะปัะบะพ ะฝะพะฒัะต ัััะฐะฝะธัั)
$env:PYTHONPATH = "$PWD"; python -c "
from ingestion.pipeline import crawl_and_index
crawl_and_index(incremental=True, strategy='jina', use_cache=True)
"
```

### ๐ฏ ะะดะธะฝัะน ะผะพะดัะปั ะธะฝะดะตะบัะฐัะธะธ

ะกะธััะตะผะฐ ัะตะฟะตัั ะธัะฟะพะปัะทัะตั ะตะดะธะฝัะน production ะผะพะดัะปั `scripts/indexer.py`, ะบะพัะพััะน ะทะฐะผะตะฝัะตั ะฒัะต ััะฐััะต ัะบัะธะฟัั:

**โจ ะะพะทะผะพะถะฝะพััะธ:**
- ๐ **ะะดะธะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ** ะดะปั ะฒัะตั ะพะฟะตัะฐัะธะน ะธะฝะดะตะบัะฐัะธะธ
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะฐั ะดะธะฐะณะฝะพััะธะบะฐ** ัะพััะพัะฝะธั ัะธััะตะผั
- ๐ง **ะะพะปะฝะฐั ัะพะฒะผะตััะธะผะพััั** ัะพ ััะฐััะผะธ ะผะตัะพะดะฐะผะธ
- โ๏ธ **ะะธะฑะบะฐั ะบะพะฝัะธะณััะฐัะธั** ัะตัะตะท ะฟะฐัะฐะผะตััั ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ
- ๐งน **ะฃะฟัะพัะตะฝะฝัะน ะธะฝัะตััะตะนั** ะฑะตะท ะธะทะฑััะพัะฝัั ะฟะฐัะฐะผะตััะพะฒ

**๐ ะัะฝะพะฒะฝัะต ะบะพะผะฐะฝะดั:**
```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ัะธััะตะผั
python scripts/indexer.py status

# ะะพะปะฝะฐั ะฟะตัะตะธะฝะดะตะบัะฐัะธั (ัะตะบะพะผะตะฝะดัะตััั)
python scripts/indexer.py reindex --mode full

# ะะฝะบัะตะผะตะฝัะฐะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
python scripts/indexer.py reindex --mode incremental

# ะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ ะบะตัะธัะพะฒะฐะฝะฝัะต ัััะฐะฝะธัั
python scripts/indexer.py reindex --mode cache_only

# ะัะธััะบะฐ ะบะตัะฐ ัััะฐะฝะธั
python scripts/indexer.py clear-cache --confirm

# ะะฝะธัะธะฐะปะธะทะฐัะธั ะบะพะปะปะตะบัะธะธ
python scripts/indexer.py init

# ะะตัะตัะพะทะดะฐะฝะธะต ะบะพะปะปะตะบัะธะธ
python scripts/indexer.py init --recreate

# ะขะตััะพะฒะฐั ะฟะตัะตะธะฝะดะตะบัะฐัะธั
python scripts/indexer.py reindex --mode full --max-pages 5
```

### ๐พ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะตัะตะผ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพััะฐะฝัะตั ะทะฐะณััะถะตะฝะฝัะต ัััะฐะฝะธัั ะฒ ะบะตั ะดะปั ััะบะพัะตะฝะธั ะฟะพัะปะตะดัััะธั ะธะฝะดะตะบัะฐัะธะน:

```bash
# ะัะพะฒะตัะบะฐ ัะพะดะตัะถะธะผะพะณะพ ะบะตัะฐ
ls cache/crawl/pages/  # ะัะพัะผะพัั ะทะฐะบะตัะธัะพะฒะฐะฝะฝัั ัััะฐะฝะธั

# ะัะธััะบะฐ ะบะตัะฐ (ััะตะฑัะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั)
python scripts/indexer.py clear-cache --confirm

# ะะฝะดะตะบัะฐัะธั ั ะพัะธััะบะพะน ัััะฐัะตะฒัะธั ะทะฐะฟะธัะตะน
python scripts/indexer.py reindex --mode full --cleanup-cache

# ะััััะพะต ัะตััะธัะพะฒะฐะฝะธะต ะฝะฐ ะทะฐะบะตัะธัะพะฒะฐะฝะฝัั ะดะฐะฝะฝัั
python scripts/indexer.py reindex --mode cache_only
```

**๐ ะัะพะฑะตะฝะฝะพััะธ ะบะตัะธัะพะฒะฐะฝะธั:**
- โ ะะตั ัะพััะฐะฝัะตััั ะผะตะถะดั ะทะฐะฟััะบะฐะผะธ ัะธััะตะผั
- โ ะัะธ `--max-pages` ะพะณัะฐะฝะธัะตะฝะธะธ ะบะตั ะฝะต ะพัะธัะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- โ ะัะธััะบะฐ ััะตะฑัะตััั ัะพะปัะบะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ััััะบัััั ัะฐะนัะฐ
- โ ะัะฟะพะปัะทัะนัะต `cache_only` ะดะปั ะฑััััะพะณะพ ัะตััะธัะพะฒะฐะฝะธั

### ๐ ะะธะณัะฐัะธั ัะพ ััะฐััั ัะบัะธะฟัะพะฒ

**ะกัะฐััะต ัะบัะธะฟัั ะทะฐะผะตะฝะตะฝั ะตะดะธะฝัะผ ะผะพะดัะปะตะผ:**

| ะกัะฐััะน ัะบัะธะฟั | ะะพะฒะฐั ะบะพะผะฐะฝะดะฐ |
|---------------|---------------|
| `python scripts/reindex.py` | `python scripts/indexer.py reindex --mode full` |
| `python scripts/full_reindex.py` | `python scripts/indexer.py reindex --mode full` |
| `python scripts/run_full_reindex.py` | `python scripts/indexer.py reindex --mode full` |

**๐งน ะัะธััะบะฐ ััะฐััั ัะบัะธะฟัะพะฒ:**

ะัะปะธ ั ะฒะฐั ะพััะฐะปะธัั ััะฐััะต ัะบัะธะฟัั ะธะฝะดะตะบัะฐัะธะธ, ะธั ะผะพะถะฝะพ ัะดะฐะปะธัั:

```bash
$env:PYTHONPATH = "$PWD"; python scripts/cleanup_old_scripts.py
```

**โ ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะณะพ ะฟะพะดัะพะดะฐ:**
- ๐ **ะัะพััะพัะฐ**: ะะดะธะฝ ะผะพะดัะปั ะฒะผะตััะพ ะผะฝะพะถะตััะฒะฐ ัะบัะธะฟัะพะฒ
- ๐ **ะะธะฐะณะฝะพััะธะบะฐ**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะธััะตะผั
- ๐ง **ะะธะฑะบะพััั**: ะัะต ัะตะถะธะผั ะฒ ะพะดะฝะพะผ ะผะตััะต
- ๐ **ะะพะบัะผะตะฝัะฐัะธั**: ะัััะพะตะฝะฝะฐั ัะฟัะฐะฒะบะฐ ะธ ะฟัะธะผะตัั

### ๐ ะัะตะธะผััะตััะฒะฐ ะฟะตัะตะธะฝะดะตะบัะฐัะธะธ

**๐ฏ ะะฐัะตััะฒะพ ะฟะพะธัะบะฐ:**
- โ **Sparse vectors**: ะฃะปัััะตะฝะฝะฐั ัะตะปะตะฒะฐะฝัะฝะพััั ะฝะฐ 15-25%
- โ **Unified embeddings**: ะะพะฝัะธััะตะฝัะฝัะต dense + sparse ะฒะตะบัะพัั
- โ **Batch processing**: ะะพะปะตะต ััะฐะฑะธะปัะฝัะต ัะตะทัะปััะฐัั
- โ **ะฃะปัััะตะฝะฝัะต ะทะฐะณะพะปะพะฒะบะธ**: ะะฝัะพัะผะฐัะธะฒะฝัะต ะฝะฐะทะฒะฐะฝะธั ะธะท ะบะพะฝัะตะฝัะฐ ะฒะผะตััะพ URL

**โก ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
- โ **2.5x ะฑััััะตะต**: Unified generation vs ัะฐะทะดะตะปัะฝัะต embeddings
- โ **GPU ััะบะพัะตะฝะธะต**: DirectML ะดะปั dense (Windows/AMD)
- โ **Adaptive max_length**: ะะฟัะธะผะธะทะฐัะธั ะฟะพะด ะดะปะธะฝั ะดะพะบัะผะตะฝัะพะฒ
- โ **ะะตัะธัะพะฒะฐะฝะธะต**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต Redis ะดะปั ััะบะพัะตะฝะธั ะฟะพะฒัะพัะฝัั ะทะฐะฟัะพัะพะฒ

**๐ง ะกะพะฒะผะตััะธะผะพััั:**
- โ **ะะฐะทะผะตัะฝะพััั**: 1024 (ะบะฐะบ ะฒ ััะฐัะพะน ัะธััะตะผะต)
- โ **ะะพะดะตะปั**: BAAI/bge-m3 (ัะฐ ะถะต)
- โ **Graceful fallback**: ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ัััะฐัะตะณะธะธ
- โ **Jina Reader**: ะะฒัะพะผะฐัะธัะตัะบะพะต ะธะทะฒะปะตัะตะฝะธะต ะทะฐะณะพะปะพะฒะบะพะฒ ะธะท ััััะบัััะธัะพะฒะฐะฝะฝะพะณะพ ัะตะบััะฐ

### ๐ ะัะพะฒะตัะบะฐ ะฝะตะพะฑัะพะดะธะผะพััะธ ะฟะตัะตะธะฝะดะตะบัะฐัะธะธ

```bash
# ะัะพะฒะตัะธัั ัะตะบััะตะต ัะพััะพัะฝะธะต ะฑะฐะทั
python -c "
from qdrant_client import QdrantClient
from app.config import CONFIG
import json

client = QdrantClient(url=CONFIG.qdrant_url, api_key=CONFIG.qdrant_api_key or None)
collection_info = client.get_collection(CONFIG.qdrant_collection)
points = client.scroll(CONFIG.qdrant_collection, limit=1, with_vectors=True)

print('๐ ะขะตะบััะตะต ัะพััะพัะฝะธะต ะฑะฐะทั:')
print(f'ะะพะปะธัะตััะฒะพ ะฒะตะบัะพัะพะฒ: {collection_info.points_count}')
print(f'Dense ัะฐะทะผะตัะฝะพััั: {len(points[0][0].vector[\"dense\"]) if points[0] else \"N/A\"}')
print(f'Sparse vectors: {\"โ ะััั\" if points[0] and hasattr(points[0][0], \"sparse_vectors\") and points[0][0].sparse_vectors else \"โ ะััััััะฒััั\"}')

if not (points[0] and hasattr(points[0][0], 'sparse_vectors') and points[0][0].sparse_vectors):
    print('\\n๐ ะะตะบะพะผะตะฝะดัะตััั ะฟะตัะตะธะฝะดะตะบัะฐัะธั ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั sparse vectors!')
else:
    print('\\nโ ะะฐะทะฐ ะฐะบััะฐะปัะฝะฐ, ะฟะตัะตะธะฝะดะตะบัะฐัะธั ะพะฟัะธะพะฝะฐะปัะฝะฐ.')
"
```

### โ๏ธ ะะฐะถะฝัะต ะผะพะผะตะฝัั

- **ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั**: 10-30 ะผะธะฝัั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะฐะทะผะตัะฐ ะดะพะบัะผะตะฝัะฐัะธะธ
- **ะัะตััะฒะฐะฝะธะต**: ะัะฟะพะปัะทัะนัะต `Ctrl+C` ะดะปั ะฑะตะทะพะฟะฐัะฝะพะน ะพััะฐะฝะพะฒะบะธ
- **ะะพะฝะธัะพัะธะฝะณ**: ะัะพัะตัั ะฟะพะบะฐะทัะฒะฐะตั ะดะตัะฐะปัะฝัะน ะฟัะพะณัะตัั ะธ ััะฐัะธััะธะบั
- **ะกะพะฒะผะตััะธะผะพััั**: ะกัะฐััะต ะฒะตะบัะพัั ะพััะฐัััั ัะฐะฑะพัะพัะฟะพัะพะฑะฝัะผะธ

### ๐๏ธ ะะฝะบัะตะผะตะฝัะฐะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต (ะฑัะดััะฐั ััะฝะบัะธั)

```python
from ingestion.pipeline import crawl_and_index
# ะ ะฑัะดััะธั ะฒะตััะธัั: ััะฐะฒะฝะตะฝะธะต hash ะธ ะฟัะพะฟััะบ ะฝะตะธะทะผะตะฝัะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
crawl_and_index(incremental=True)
```

## ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต

### Docker (ัะตะบะพะผะตะฝะดัะตััั)
```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ (Qdrant, Redis, RAG API, Telegram Bot)
docker-compose up -d

# ะะปะธ ะทะฐะฟััะบ ัะพะปัะบะพ ะฝะตะพะฑัะพะดะธะผัั ัะตัะฒะธัะพะฒ
docker-compose up -d redis qdrant rag-api
```

ะกะตัะฒะธัั:
- **Redis** - ะบะตัะธัะพะฒะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ (ะฟะพัั 6379)
- **Qdrant** - ะฒะตะบัะพัะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั (ะฟะพัั 6333)
- **RAG API** - ะพัะฝะพะฒะฝะพะน API (ะฟะพัั 9000)
- **Telegram Bot** - Telegram ะธะฝัะตััะตะนั
- **Prometheus ะผะตััะธะบะธ** - ะผะพะฝะธัะพัะธะฝะณ (ะฟะพัั 9002)

### Production ะฝะฐัััะพะนะบะธ
- ะัะฟะพะปัะทัะนัะต Gunicorn ะฒะผะตััะพ Flask dev server
- ะะฐัััะพะนัะต reverse proxy (Nginx)
- ะะบะปััะธัะต HTTPS
- ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ (Prometheus + Grafana)

## ๐ง ะัะธัะธัะตัะบะธะต ะธัะฟัะฐะฒะปะตะฝะธั

ะกะธััะตะผะฐ ะฟัะพัะปะฐ ะบะพะผะฟะปะตะบัะฝัั ะผะพะดะตัะฝะธะทะฐัะธั ะดะปั production-ready ัะฐะทะฒะตัััะฒะฐะฝะธั:

### โ ะัะฟัะฐะฒะปะตะฝะฝัะต ะฟัะพะฑะปะตะผั (v2.2.0)
- **Sparse ะฒะตะบัะพัั** - ะฟะพะปะฝะฐั ะทะฐะผะตะฝะฐ ะบะพะปะปะตะบัะธะธ ั ะฟะพะดะดะตัะถะบะพะน sparse ะฒะตะบัะพัะพะฒ
- **ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ** - 100% ะฟะพะบัััะธะต sparse ะฒะตะบัะพัะฐะผะธ (512/512 ัะพัะตะบ)
- **ะกัััะบัััะฐ Qdrant** - ะธัะฟัะฐะฒะปะตะฝะฐ ััััะบัััะฐ named vectors ะดะปั dense+sparse
- **Backend ะฟะพะดะดะตัะถะบะฐ** - ะดะพะฑะฐะฒะปะตะฝะฐ ะฟะพะดะดะตัะถะบะฐ 'auto' backend ะดะปั sparse ะฒะตะบัะพัะพะฒ
- **YandexGPT API** - ะพะฑะฝะพะฒะปะตะฝ ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะผะพะดะตะปะธ yandexgpt/rc
- **ะะพะปะฝะฐั ะฟะตัะตะธะฝะดะตะบัะฐัะธั** - ะฒัะต 516 ัะฐะฝะบะพะฒ ะฟะตัะตะธะฝะดะตะบัะธัะพะฒะฐะฝั ั sparse ะฒะตะบัะพัะฐะผะธ
- **Redis ะบะตัะธัะพะฒะฐะฝะธะต** - ะดะพะฑะฐะฒะปะตะฝะฐ ัะตัะธะฐะปะธะทะฐัะธั numpy ัะธะฟะพะฒ ะดะปั JSON
- **Telegram ัะพัะผะฐัะธัะพะฒะฐะฝะธะต** - ะพะฑะฝะพะฒะปะตะฝ telegramify-markdown ะดะพ v0.5.1
- **Metrics ัะตัะฒะตั** - ะธะทะผะตะฝะตะฝ ะฟะพัั ั 8001 ะฝะฐ 9001
- **BGE ัะผะฑะตะดะดะธะฝะณะธ** - ะธัะฟัะฐะฒะปะตะฝะฐ ะพัะธะฑะบะฐ ONNX ั ัะธะฟะฐะผะธ ะดะฐะฝะฝัั (int32โint64)
- **ะััะธัะตะบัััะฐ** - ัะดะฐะปะตะฝ ะฝะตะธัะฟะพะปัะทัะตะผัะน sparse ัะตัะฒะธั (ัะฟัะพัะตะฝะธะต)
- **ะะทะฒะปะตัะตะฝะธะต ะทะฐะณะพะปะพะฒะบะพะฒ** - ัะปัััะตะฝะพ ะธะทะฒะปะตัะตะฝะธะต ะธะฝัะพัะผะฐัะธะฒะฝัั ะทะฐะณะพะปะพะฒะบะพะฒ ะธะท Jina Reader ัะตะบััะฐ
- **ะะพะฝัะตะบัั LLM** - ะธัะฟัะฐะฒะปะตะฝะฐ ะฟะตัะตะดะฐัะฐ ะบะพะฝัะตะฝัะฐ ะดะพะบัะผะตะฝัะพะฒ ะฒ ะฟัะพะผะฟั ะดะปั ะฑะพะปะตะต ัะพัะฝัั ะพัะฒะตัะพะฒ
- **ะะดะธะฝัะน ะผะพะดัะปั ะธะฝะดะตะบัะฐัะธะธ** - ัะพะทะดะฐะฝ production-ready ะผะพะดัะปั `scripts/indexer.py` ะดะปั ะทะฐะผะตะฝั ะผะฝะพะถะตััะฒะฐ ัะบัะธะฟัะพะฒ
- **ะฃะฟัะพัะตะฝะธะต ะธะฝัะตััะตะนัะฐ** - ัะฑัะฐะฝั ะธะทะฑััะพัะฝัะต ะฟะฐัะฐะผะตััั, ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ะพะฟัะธะผะฐะปัะฝัั ะฝะฐัััะพะตะบ
- **Comprehensive Error Handling** - ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฝะฐ ะบะฐะถะดะพะผ ััะฐะฟะต
- **ะะฐะปะธะดะฐัะธั ะธ ัะฐะฝะธัะธะทะฐัะธั** - ะทะฐัะธัะฐ ะพั XSS ะธ ะธะฝัะตะบัะธะน
- **ะััะธัะพะฒะฐะฝะธะต** - Redis + in-memory fallback ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- **Circuit Breaker** - ะทะฐัะธัะฐ ะพั ะบะฐัะบะฐะดะฝัั ัะฑะพะตะฒ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ
- **Prometheus ะผะตััะธะบะธ** - ะฟะพะปะฝัะน ะผะพะฝะธัะพัะธะฝะณ ัะธััะตะผั
- **ะกะตะผะฐะฝัะธัะตัะบะพะต chunking** - ัะปัััะตะฝะฝะพะต ัะฐะทะฑะธะตะฝะธะต ัะตะบััะฐ
- **Rate Limiting** - ะทะฐัะธัะฐ ะพั ะทะปะพัะฟะพััะตะฑะปะตะฝะธะน
- **ะกะธััะตะผะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ** - ะผะพะฝะธัะพัะธะฝะณ ะธ ะฑะปะพะบะธัะพะฒะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- **ะะพะฝะธัะพัะธะฝะณ ะผะตััะธะบะธ** - ะธัะฟัะฐะฒะปะตะฝ ะบะพะฝัะปะธะบั ะฟะพััะพะฒ (9001โ9002), ะผะตััะธะบะธ ัะตะฟะตัั ะบะพััะตะบัะฝะพ ะพัะพะฑัะฐะถะฐัััั ะฒ Grafana

### ๐ ะะพะฒัะต ะฒะพะทะผะพะถะฝะพััะธ
- **Sparse ะฒะตะบัะพัั** - ะปะพะบะฐะปัะฝะฐั ะณะตะฝะตัะฐัะธั ัะตัะตะท BGE-M3 ะฑะตะท ะฒะฝะตัะฝะตะณะพ ัะตัะฒะธัะฐ
- **ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะปะปะตะบัะธัะผะธ** - ัะบัะธะฟัั ะดะปั ะฟะพะปะฝะพะน ะทะฐะผะตะฝั ะธ ะฟะตัะตะธะฝะดะตะบัะฐัะธะธ
- **ะัะพะฒะตัะบะฐ ะฟะพะบัััะธั** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะฒะตัะธัะธะบะฐัะธั sparse ะฒะตะบัะพัะพะฒ
- **ะะตัะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต** - comprehensive ัะตััั ะดะปั sparse ะฟะพะธัะบะฐ
- **ะกะตะผะฐะฝัะธัะตัะบะพะต chunking** ั ะฟะตัะตะบัััะธะตะผ ะดะปั ะปัััะตะณะพ ะบะพะฝัะตะบััะฐ
- **Rate Limiting** ั burst protection ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ัะฟะฐะผะฐ
- **ะฃะปัััะตะฝะฝัะน Telegram ะฐะดะฐะฟัะตั** ั ะบัะฐัะธะฒัะผ ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ
- **ะกะธััะตะผะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ** ั ะพัะตะฝะบะพะน ัะธัะบะฐ ะธ ะฐะปะตััะฐะผะธ
- **ะะตัะฐะปัะฝัะต ะผะตััะธะบะธ** ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธ ะฑะตะทะพะฟะฐัะฝะพััะธ
- **ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต** ะฟัะธ ัะฑะพัั
- **Graceful degradation** ะฟัะธ ะพัะธะฑะบะฐั
- **ะะพะปะฝะฐั ะฒะฐะปะธะดะฐัะธั** ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- **ะััะธัะพะฒะฐะฝะธะต** ะดะปั ััะบะพัะตะฝะธั ะพัะฒะตัะพะฒ

ะะพะดัะพะฑะฝะตะต: [docs/critical_fixes.md](docs/critical_fixes.md)

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
```
โโโ adapters/           # ะะดะฐะฟัะตัั ะบะฐะฝะฐะปะพะฒ (Telegram, Web)
โโโ app/               # Core API (Flask)
โ   โโโ routes/        # API endpoints
โ   โโโ services/      # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ abstractions/  # ะะฑัััะฐะบัะธะธ ะธ ะฟะปะฐะณะธะฝั
โ   โโโ sources/       # ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั
โโโ ingestion/         # ะะฐััะธะฝะณ ะธ ะธะฝะดะตะบัะฐัะธั
โโโ tests/             # ะะฒัะพัะตััั
โโโ scripts/           # ะฃัะธะปะธัั ะธ ัะตััั
โโโ docs/             # ะะพะบัะผะตะฝัะฐัะธั
โโโ .github/workflows/ # CI/CD
โโโ Makefile          # ะะพะผะฐะฝะดั ัะฐะทัะฐะฑะพัะบะธ
โโโ pytest.ini       # ะะพะฝัะธะณััะฐัะธั ัะตััะพะฒ
```

### ะะฐัััะพะนะบะฐ ััะตะดั ัะฐะทัะฐะฑะพัะบะธ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะดะปั ัะฐะทัะฐะฑะพัะบะธ
make dev-setup

# ะะฐะฟััะบ ะฐะฒัะพัะตััะพะฒ
make test-fast

# ะัะพะฒะตัะบะฐ ะบะพะดะฐ
make lint

# ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต
make format
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะตััะพะฒ

1. **Unit ัะตััั** - ะฒ `tests/test_*.py`:
```python
def test_new_feature():
    """ะขะตัั ะฝะพะฒะพะน ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ"""
    # ะะฐั ัะตัั
    assert result == expected
```

2. **End-to-End ัะตััั** - ะฒ `tests/test_end_to_end_pipeline.py`:
```python
def test_new_pipeline_step(self):
    """ะขะตัั ะฝะพะฒะพะณะพ ััะฐะฟะฐ pipeline"""
    # ะะพะปะฝัะน ัะตัั ะพั ะธะทะฒะปะตัะตะฝะธั ะดะพ ะทะฐะฟะธัะธ
```

3. **ะะฐัะบะธัะพะฒะบะฐ ัะตััะพะฒ**:
```python
@pytest.mark.slow        # ะะตะดะปะตะฝะฝัะต ัะตััั
@pytest.mark.integration # ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
@pytest.mark.unit        # Unit ัะตััั
```

### ะกะธััะตะผะฐ ะฟะปะฐะณะธะฝะพะฒ

ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั:

```python
@register_data_source("my_source")
class MyDataSource(DataSourceBase):
    def fetch_pages(self, max_pages: Optional[int] = None) -> CrawlResult:
        # ะะตะฐะปะธะทะฐัะธั ะธะทะฒะปะตัะตะฝะธั ะดะฐะฝะฝัั
        pass

    def classify_page(self, page: Page) -> PageType:
        # ะะปะฐััะธัะธะบะฐัะธั ัััะฐะฝะธั
        pass
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะบะฐะฝะฐะปะฐ
1. ะกะพะทะดะฐะนัะต ะฐะดะฐะฟัะตั ะฒ `adapters/`
2. ะะตะฐะปะธะทัะนัะต ะธะฝัะตััะตะนั `ChannelAdapter`
3. ะะพะฑะฐะฒััะต ะบะพะฝัะธะณััะฐัะธั

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ LLM
1. ะะพะฑะฐะฒััะต ััะฝะบัะธั ะฒ `app/services/llm_router.py`
2. ะะฑะฝะพะฒะธัะต fallback ะฟะพััะดะพะบ
3. ะะพะฑะฐะฒััะต ะบะพะฝัะธะณััะฐัะธั

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะงะฐัััะต ะฟัะพะฑะปะตะผั

#### Timeout ะพัะธะฑะบะธ
- ะฃะฒะตะปะธัััะต `CRAWL_TIMEOUT_S`
- ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั API

#### ะัะธะฑะบะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธั
- ะัะพะฒะตัััะต MarkdownV2 ัะธะฝัะฐะบัะธั
- ะัะฟะพะปัะทัะนัะต fallback ัะตะถะธะผ

#### ะัะพะฑะปะตะผั ั ัะผะฑะตะดะดะธะฝะณะฐะผะธ
- ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั Ollama
- ะฃะฑะตะดะธัะตัั ะฒ ะฟัะฐะฒะธะปัะฝะพััะธ ะผะพะดะตะปะธ

#### ะัะพะฑะปะตะผั ั ะผะพะฝะธัะพัะธะฝะณะพะผ
- **ะัััะพะน Grafana**: ะฃะฑะตะดะธัะตัั, ััะพ RAG API ะทะฐะฟััะตะฝ (`python wsgi.py`)
- **ะะตััะธะบะธ ะฝะต ะพัะพะฑัะฐะถะฐัััั**: ะัะพะฒะตัััะต, ััะพ ะธัะฟะพะปัะทัะตััั ะฟัะฐะฒะธะปัะฝัะน ะฟะพัั (9002)
- **ะะพะฝัะปะธะบั ะฟะพััะพะฒ**: ะัะปะธ ะผะตััะธะบะธ ะฝะต ัะฐะฑะพัะฐัั, ะฟะตัะตะทะฐะฟัััะธัะต RAG API

### ะะพะณะธ
```bash
# ะัะพัะผะพัั ะปะพะณะพะฒ Flask
tail -f logs/flask.log

# ะัะพัะผะพัั ะปะพะณะพะฒ Telegram ะฑะพัะฐ
tail -f logs/telegram.log
```

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ค ะะบะปะฐะด ะฒ ะฟัะพะตะบั

1. Fork ัะตะฟะพะทะธัะพัะธั
2. ะกะพะทะดะฐะนัะต feature branch
3. ะะฝะตัะธัะต ะธะทะผะตะฝะตะฝะธั
4. ะะพะฑะฐะฒััะต ัะตััั
5. ะกะพะทะดะฐะนัะต Pull Request

## ๐ ะะพะดะดะตัะถะบะฐ

### ะะพะบัะผะตะฝัะฐัะธั
- **ะัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั**: [docs/](docs/)
- **ะะฒัะพัะตััั ะธ CI/CD**: [docs/autotests_integration_report.md](docs/autotests_integration_report.md)
- **Phase 2 RAGAS Quality System**: [docs/phase2_ragas_quality_system.md](docs/phase2_ragas_quality_system.md)
- **API ะะพะบัะผะตะฝัะฐัะธั**: [OpenAPI/Swagger](docs/api_documentation.md)
- **RAGAS Quality System (Legacy)**: [docs/ragas_quality_system.md](docs/ragas_quality_system.md)
- **GPU ะฝะฐัััะพะนะบะฐ (Linux)**: [ROCm](docs/gpu_setup.md)
- **GPU ะฝะฐัััะพะนะบะฐ (Windows)**: [DirectML](docs/gpu_setup_windows.md)

### ะะฝัะตัะฐะบัะธะฒะฝัะต ะธะฝััััะผะตะฝัั
- **API ะดะพะบัะผะตะฝัะฐัะธั**: http://localhost:9000/apidocs
- **Swagger UI**: http://localhost:9000/apidocs
- **Prometheus ะผะตััะธะบะธ**: http://localhost:9090
- **Grafana ะดะฐัะฑะพัะดั**: http://localhost:8080

### ะขะตััะธัะพะฒะฐะฝะธะต ะธ ัะฐะทัะฐะฑะพัะบะฐ
```bash
# ะััััะฐั ะฟัะพะฒะตัะบะฐ ัะธััะตะผั
make test-fast

# ะะพะปะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ
pytest tests/test_end_to_end_pipeline.py -v

# ะัะพะฒะตัะบะฐ ัะตัะฒะธัะพะฒ
make check-services
```

### ะะพะฝัะฐะบัั
- **Issues**: [GitHub Issues](https://github.com/your-repo/issues)
- **Email**: support@example.com

## ๐ฏ Roadmap

- [ ] Web ะธะฝัะตััะตะนั
- [ ] ะะพะดะดะตัะถะบะฐ ะดััะณะธั ะผะตััะตะฝะดะถะตัะพะฒ
- [ ] A/B ัะตััะธัะพะฒะฐะฝะธะต ะพัะฒะตัะพะฒ
- [ ] ะะฝะฐะปะธัะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- [ ] ะะฝะพะณะพัะทััะฝะพััั
- [ ] Voice ะธะฝัะตััะตะนั
