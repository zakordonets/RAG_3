# üìä RAGAS Quality System Documentation

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ RAG (Retrieval-Augmented Generation) –Ω–∞ –æ—Å–Ω–æ–≤–µ RAGAS (Retrieval-Augmented Generation Assessment) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ —á–∞—Ç-–±–æ—Ç–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  RAG Orchestrator ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Quality Manager ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                        ‚îÇ
                                ‚ñº                        ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   RAGAS Evaluator ‚îÇ    ‚îÇ Quality Database ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                        ‚îÇ
                                ‚ñº                        ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  Fallback Scores ‚îÇ    ‚îÇ  Metrics System ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. RAGAS Evaluator (`app/services/ragas_evaluator.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAGAS –º–µ—Ç—Ä–∏–∫.

**–ú–µ—Ç—Ä–∏–∫–∏**:
- **Faithfulness**: –ù–∞—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **Context Precision**: –ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **Answer Relevancy**: –ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –∑–∞–ø—Ä–æ—Å—É

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
class RAGASEvaluatorWithoutGroundTruth:
    def __init__(self):
        self.llm_wrapper = YandexGPTLangChainWrapper()
        self.embeddings_wrapper = BGELangChainWrapper()

        self.faithfulness = Faithfulness(llm=self.llm_wrapper)
        self.context_precision = ContextPrecision(llm=self.llm_wrapper)
        self.answer_relevancy = AnswerRelevancy(llm=self.llm_wrapper)
```

### 2. Quality Manager (`app/services/quality_manager.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π.

**–§—É–Ω–∫—Ü–∏–∏**:
- –û—Ü–µ–Ω–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### 3. Quality Database (`app/models/quality_interaction.py`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.

**–°—Ö–µ–º–∞**:
```sql
CREATE TABLE quality_interactions (
    interaction_id VARCHAR(255) PRIMARY KEY,
    query TEXT NOT NULL,
    response TEXT NOT NULL,
    contexts TEXT,
    sources TEXT,
    ragas_faithfulness FLOAT,
    ragas_context_precision FLOAT,
    ragas_answer_relevancy FLOAT,
    ragas_overall_score FLOAT,
    user_feedback_type VARCHAR(50),
    user_feedback_text TEXT,
    combined_score FLOAT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# RAGAS Quality Evaluation
ENABLE_RAGAS_EVALUATION=true
RAGAS_EVALUATION_SAMPLE_RATE=0.1
RAGAS_BATCH_SIZE=10
RAGAS_ASYNC_TIMEOUT=30
RAGAS_LLM_MODEL=yandexgpt

# Quality Database
QUALITY_DB_ENABLED=true
DATABASE_URL=sqlite:///data/quality_interactions.db

# Quality Metrics
ENABLE_QUALITY_METRICS=true
QUALITY_PREDICTION_THRESHOLD=0.7
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –í–ª–∏—è–Ω–∏–µ |
|----------|----------|--------------|---------|
| `ENABLE_RAGAS_EVALUATION` | –í–∫–ª—é—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É RAGAS | `false` | –û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–∏—Å—Ç–µ–º—ã |
| `RAGAS_EVALUATION_SAMPLE_RATE` | –î–æ–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ | `0.1` | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å vs —Ç–æ—á–Ω–æ—Å—Ç—å |
| `RAGAS_BATCH_SIZE` | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | `10` | –ü–∞–º—è—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å |
| `RAGAS_ASYNC_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π | `30` | –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å |
| `QUALITY_DB_ENABLED` | –í–∫–ª—é—á–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤–∞ | `false` | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| `DATABASE_URL` | URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | SQLite | –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å |
| `ENABLE_QUALITY_METRICS` | –í–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus | `false` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
from app.services.quality_manager import quality_manager

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
await quality_manager.initialize()

# –û—Ü–µ–Ω–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
interaction_id = await quality_manager.evaluate_interaction(
    query="–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é?",
    response="–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API...",
    contexts=["–ö–æ–Ω—Ç–µ–∫—Å—Ç 1", "–ö–æ–Ω—Ç–µ–∫—Å—Ç 2"],
    sources=["https://docs.example.com"]
)

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
await quality_manager.add_user_feedback(
    interaction_id=interaction_id,
    feedback_type="positive",
    feedback_text="–û—Ç–ª–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç!"
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
stats = await quality_manager.get_quality_statistics(days=7)
print(f"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π: {stats['total_interactions']}")
print(f"–°—Ä–µ–¥–Ω–∏–π RAGAS score: {stats['avg_ragas_score']:.3f}")
print(f"–ü—Ä–æ—Ü–µ–Ω—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: {stats['satisfaction_rate']:.1f}%")
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

**–ö–ª—é—á–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `ragas==0.1.21` - –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ RAGAS
- `datasets==2.19.0` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `langchain==0.2.16` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
- `sqlalchemy==2.0.23` - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `alembic==1.13.1` - –ú–∏–≥—Ä–∞—Ü–∏–∏

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
python scripts/init_quality_db.py
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
python scripts/test_ragas_integration.py
python scripts/test_simple_ragas.py
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

#### 1. **RAGAS OpenAI Dependency**
**–ü—Ä–æ–±–ª–µ–º–∞**: RAGAS –º–µ—Ç—Ä–∏–∫–∏ (`ContextPrecision`, `AnswerRelevancy`) **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç OpenAI embeddings** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–û—à–∏–±–∫–∞**:
```
1 validation error for OpenAIEmbeddings
Did not find openai_api_key
```

**–†–µ—à–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ **fallback scores** –ø—Ä–∏ –æ—à–∏–±–∫–µ.

#### 2. **LangChain Compatibility**
**–ü—Ä–æ–±–ª–µ–º–∞**: –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ—á–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π LangChain —Å RAGAS.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏**:
- `langchain==0.2.16`
- `langchain-community==0.2.16`
- `langchain-core==0.2.38`
- `ragas==0.1.21`

**–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏**:
- `langchain>=0.3.0` - –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
- `ragas>=0.2.0` - –∏–∑–º–µ–Ω–∏–ª—Å—è API

#### 3. **Dataset Format Requirements**
**–ü—Ä–æ–±–ª–µ–º–∞**: RAGAS —Ç—Ä–µ–±—É–µ—Ç —Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Dataset.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
```python
dataset = Dataset.from_dict({
    'question': [query],           # string
    'answer': [response],          # string
    'contexts': [contexts],        # List[string]
    'ground_truth': [""]           # string (–Ω–µ List[string]!)
})
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 1. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
- **RAGAS evaluation**: 2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- **Fallback scores**: <100ms –Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- **Database operations**: <50ms –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é

#### 2. **–ü–∞–º—è—Ç—å**
- **RAGAS**: ~500MB RAM –¥–ª—è –º–µ—Ç—Ä–∏–∫
- **Database**: ~10MB –Ω–∞ 10,000 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- **LangChain wrappers**: ~100MB RAM

#### 3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- **SQLite**: –¥–æ 1,000 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π/–º–∏–Ω—É—Ç—É
- **PostgreSQL**: –¥–æ 10,000 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π/–º–∏–Ω—É—Ç—É
- **Batch processing**: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–∞—Ç—á–∏ –ø–æ 10-20

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

#### 1. **Fallback Mechanism**
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ fallback scores –ø—Ä–∏:
- –û—à–∏–±–∫–∞—Ö RAGAS evaluation
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ OpenAI API –∫–ª—é—á–∞
- –ü—Ä–æ–±–ª–µ–º–∞—Ö —Å LangChain wrappers
- –û—à–∏–±–∫–∞—Ö Dataset —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 2. **Error Handling**
```python
try:
    # RAGAS evaluation
    scores = await ragas_evaluator.evaluate_interaction(...)
except Exception as e:
    logger.error(f"RAGAS evaluation failed: {e}")
    # Automatic fallback
    scores = self._calculate_fallback_scores(...)
```

#### 3. **Database Resilience**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

```python
# RAGAS scores
ragas_score_gauge = Gauge('ragas_score', 'RAGAS quality score', ['metric_type'])
user_satisfaction_rate = Gauge('user_satisfaction_rate', 'User satisfaction rate')
quality_evaluation_duration = Histogram('quality_evaluation_duration_seconds', 'Quality evaluation duration')

# Recording metrics
metrics_collector.record_ragas_score(
    faithfulness=0.8,
    context_precision=0.7,
    answer_relevancy=0.9,
    overall_score=0.8
)
```

### Grafana Dashboard

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
- RAGAS scores –ø–æ —Ç–∏–ø–∞–º –º–µ—Ç—Ä–∏–∫
- User satisfaction rate
- Quality evaluation duration
- Database interaction count
- Error rates

**URL**: `http://localhost:8080` (Grafana)

## üõ†Ô∏è Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **"OpenAI API key not found"**
**–ü—Ä–∏—á–∏–Ω–∞**: RAGAS –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI embeddings.

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ENABLE_RAGAS_EVALUATION=false` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è RAGAS
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback scores (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

#### 2. **"LangChain import errors"**
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏ LangChain.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
pip uninstall langchain langchain-community langchain-core
pip install langchain==0.2.16 langchain-community==0.2.16 langchain-core==0.2.38
```

#### 3. **"Database connection failed"**
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
rm data/quality_interactions.db
python scripts/init_quality_db.py
```

#### 4. **"RAGAS evaluation timeout"**
**–ü—Ä–∏—á–∏–Ω–∞**: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ LLM –≤—ã–∑–æ–≤—ã.

**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–∏—Ç—å `RAGAS_ASYNC_TIMEOUT`
- –£–º–µ–Ω—å—à–∏—Ç—å `RAGAS_EVALUATION_SAMPLE_RATE`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback scores

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤**:
- `INFO`: –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
- `WARNING`: –ü—Ä–æ–±–ª–µ–º—ã, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã
- `ERROR`: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, fallback –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- `DEBUG`: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤**:
```
2025-09-21 22:07:39.993 | INFO | RAGAS evaluation completed: {'faithfulness': 0.7, 'context_precision': 0.6, 'answer_relevancy': 0.8, 'overall_score': 0.7}
2025-09-21 22:07:39.993 | ERROR | RAGAS evaluation failed: OpenAI API key not found
2025-09-21 22:07:39.993 | INFO | Using fallback scores: {'faithfulness': 0.7, 'context_precision': 0.6, 'answer_relevancy': 0.8, 'overall_score': 0.7}
```

## üîÆ Roadmap –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–£–ª—É—á—à–µ–Ω–∏–µ fallback scores**
   - –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏
   - –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ü–µ–Ω–∫–∏
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫**
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ RAGAS –º–µ—Ç—Ä–∏–∫–∏
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
   - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–ü–æ–ª–Ω–∞—è RAGAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å OpenAI dependency
   - –ö–∞—Å—Ç–æ–º–Ω—ã–µ embeddings –¥–ª—è RAGAS
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LangChain wrappers

2. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**
   - –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ñ–∏–¥–±–µ–∫–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞

3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [RAGAS Documentation](https://docs.ragas.io/)
- [LangChain Documentation](https://python.langchain.com/)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `scripts/test_ragas_integration.py` - –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `scripts/test_simple_ragas.py` - –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `scripts/init_quality_db.py` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `env.example` - –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `app/config.py` - –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `monitoring/prometheus.yml` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 1.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-09-21
**–ê–≤—Ç–æ—Ä**: RAG System Team
