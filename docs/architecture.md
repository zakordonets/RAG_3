## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è edna Chat Center

### –¶–µ–ª–∏
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ edna Chat Center —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (—Å—Ç–∞—Ä—Ç —Å Telegram; –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Web/Widget, email, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–Ω–µ–ª–∏).
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (dense + sparse) –≤ Qdrant, RRF –∏ ML-—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ (bge-reranker-v2-m3).
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è HTML-–ø–æ—Ä—Ç–∞–ª–∞ `https://docs-chatcenter.edna.ru/` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —á–∞–Ω–∫–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ (retrieval + generation), —Å fallback –ª–æ–≥–∏–∫–æ–π LLM.

### üéâ –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: v4.3.0 (2025-10-08)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è:**
- üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞** - —É–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `chunk_text`, —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞ —É–º–µ–Ω—å—à–µ–Ω ~–≤ 2 —Ä–∞–∑–∞
- ‚öôÔ∏è **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞–Ω–∫–∏–Ω–≥–∞** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `.env` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (CHUNK_MIN/MAX_TOKENS)
- üîó **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ ContentRef** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ Docusaurus
- üìä **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ X/Y (Z%)
- üê≥ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Redis** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `rag-redis` –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (v4.2.0):**
- üîß **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è QdrantWriter** - sparse –≤–µ–∫—Ç–æ—Ä—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
- üéØ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** - dense + sparse —Å RRF fusion —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - —Ä–µ—Ç—Ä–∞–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫
- üìä **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** - doc_id, heading_path –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- üîç **–£–ª—É—á—à–µ–Ω–Ω—ã–π retrieval** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π recall
- üèóÔ∏è **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π** - ensure_collection() —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å—Ö–µ–º–æ–π

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1) Channel Adapters (–≤–Ω–µ—à–Ω–∏–µ –∫–∞–Ω–∞–ª—ã)
- **Telegram Adapter** (long polling): —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –≤ Core API/–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä.
  - –ö—Ä–∞—Å–∏–≤–æ–µ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
  - –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è ChannelAdapter**: –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Web-–≤–∏–¥–∂–µ—Ç, edna API Bot Connect (email/WhatsApp ‚Äî –ø–æ–∑–∂–µ, –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

#### 2) Core API (Flask)
- **REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
  - `POST /v1/chat/query` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—Ä–æ—Å–∞ (–¥–ª—è –ª—é–±—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)
  - `POST /v1/admin/reindex` ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - `GET /v1/admin/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å Circuit Breakers
  - `GET /v1/admin/metrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ Prometheus
  - `GET /apidocs` ‚Äî Swagger UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—Ä–∫–µ—Å—Ç—Ä–æ–≤–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞**: Query Processing ‚Üí Retrieval ‚Üí Rerank ‚Üí Generation ‚Üí Postprocess
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Marshmallow —Å—Ö–µ–º—ã, —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, rate limiting

#### 3) Ingestion Pipeline (–ï–î–ò–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê DAG) ‚≠ê

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ä—ã–≤ v4.1.0+:** –°–æ–∑–¥–∞–Ω–∞ –µ–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å –æ–¥–Ω–∏–º DAG –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤.

**–ï–¥–∏–Ω—ã–π entrypoint** (`ingestion/run.py`):
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π DAG: Parse ‚Üí Normalize ‚Üí Chunk ‚Üí Embed ‚Üí Index
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML –∏ CLI –∞—Ä–≥—É–º–µ–Ω—Ç—ã
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å StateManager

**Source Adapters** (`ingestion/adapters/`):
- `DocusaurusAdapter` - –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã Docusaurus
- `WebsiteAdapter` - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤ (HTTP/HTML)
- –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `SourceAdapter` –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ URL

**Pipeline Steps** (`ingestion/pipeline/`):
- `Parser` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä (Markdown/HTML)
- `DocusaurusNormalizer` - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è Docusaurus
- `URLMapper` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π –≤ URL
- `HtmlNormalizer` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `UnifiedChunkerStep` - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —á–∞–Ω–∫–æ–≤–∞–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `Embedder` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è dense –∏ sparse –≤–µ–∫—Ç–æ—Ä–æ–≤
- `QdrantWriter` - –∑–∞–ø–∏—Å—å –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**State Management** (`ingestion/state/`):
- `StateManager` - –µ–¥–∏–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ hash –∏ mtime
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**Normalizers** (`ingestion/normalizers/`):
- –ü–ª–∞–≥–∏–Ω—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –û—á–∏—Å—Ç–∫–∞ JSX, –∏–º–ø–æ—Ä—Ç–æ–≤, admonitions –¥–ª—è Docusaurus
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ HTML
- –û–±—Ä–∞–±–æ—Ç–∫–∞ ContentRef —Å—Å—ã–ª–æ–∫ (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç —Å URL)

**Chunker** (`ingestion/chunking/`):
- `UniversalChunker` - —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ: 150-300 —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ CHUNK_MIN/MAX_TOKENS)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –∏ –ø—Ä–æ—Å—Ç—ã–º —á–∞–Ω–∫–∏–Ω–≥–æ–º
- –ö–æ–Ω—Ç—Ä–æ–ª—å min/max –¥–ª–∏–Ω—ã, deduplication
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–∏–µ—Ä–∞—Ä—Ö–∏—è H1‚ÄìH6) –∏ —Ç–∞–±–ª–∏—Ü

**Embedding Service** (`app/services/core/embeddings.py`):
- Dense: BGE-M3 —á–µ—Ä–µ–∑ ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ) ‚Üí –≤–µ–∫—Ç–æ—Ä 1024 –∏–∑–º–µ—Ä–µ–Ω–∏–π
- Sparse: BGE-M3 sparse (–ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ CPU) ‚Üí —Å–ª–æ–≤–∞—Ä—å {term: weight}
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis —Å in-memory fallback

**Qdrant Writer** (`ingestion/pipeline/indexers/qdrant_writer.py`):
- –ì–∏–±—Ä–∏–¥–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å named vectors: dense-–≤–µ–∫—Ç–æ—Ä, sparse-–≤–µ–∫—Ç–æ—Ä, payload
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π (ensure_collection)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: sparse –≤–µ–∫—Ç–æ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–µ sparse_vectors
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è payload**: —É–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (chunk_text)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã: doc_id, heading_path –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: —Ä–µ—Ç—Ä–∞–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏, –∑–∞—â–∏—Ç–∞ –æ—Ç numpy —Ç–∏–ø–æ–≤
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö—ç—à–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞/updated_at; upsert –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤

#### 4) Query Processing
- **Entity Extraction**: –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–æ–º–µ–Ω–∞ (—Ä–∞–∑–¥–µ–ª—ã –ø–æ—Ä—Ç–∞–ª–∞: ¬´–ê–†–ú –∞–≥–µ–Ω—Ç–∞¬ª, ¬´API¬ª –∏ —Ç.–ø.)
- **Query Rewriting/Normalization**: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –≤–æ–ø—Ä–æ—Å–∞ (—Å–∏–Ω–æ–Ω–∏–º—ã, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π)
- **Query Decomposition**: –ø–æ—à–∞–≥–æ–≤–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞, max_depth=3)

#### 5) Retrieval Layer

**HybridRetriever –¥–ª—è Qdrant**:
- **Dense-–≤–µ–∫—Ç–æ—Ä—ã**: BGE-M3 —á–µ—Ä–µ–∑ ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ) –∏–ª–∏ CPU fallback
- **Sparse-–≤–µ–∫—Ç–æ—Ä—ã**: BGE-M3 sparse (–ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ BGE-M3 –Ω–∞ CPU)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –≤–º–µ—Å—Ç–µ —Å dense –≤ Qdrant –∫–∞–∫ named vectors
- **Fusion**: RRF (Reciprocal Rank Fusion) –ø–æ–≤–µ—Ä—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ dense –∏ sparse
- **Metadata-boost**: —É—á–µ—Ç `page_type` (API/FAQ/guide/release_notes), —Å–≤–µ–∂–µ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º—ã –≤–æ–ø—Ä–æ—Å–∞

**–†–µ—Ä–∞–Ω–∫–∏–Ω–≥**:
- bge-reranker-v2-m3 –ø–æ top-N (–Ω–∞–ø—Ä–∏–º–µ—Ä, N=30 ‚Üí —Ç–æ–ø-10)

**Auto-Merge** (v4.3.0):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ—Å–µ–¥–Ω–∏—Ö —á–∞–Ω–∫–æ–≤ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ rerank
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–∫–æ–Ω –≤ —Ä–∞–º–∫–∞—Ö token budget
- TTL-–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (maxsize=1000, ttl=300s)
- –¢–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ tiktoken (fallback: —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ len//4)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ context optimizer
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ª–∏—è–Ω–∏—è: auto_merged, merged_chunk_indices, chunk_span
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [AUTO_MERGE.md](./AUTO_MERGE.md)

**Context Optimizer**:
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Å–ø–∏—Å–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ Markdown
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å–ø–∏—Å–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∞–º, –∞ –Ω–µ –Ω–∞—á–∞–ª—É –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–†–µ—Å—É—Ä—Å—ã**: Hybrid CPU+GPU –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (DirectML –¥–ª—è dense, CPU –¥–ª—è sparse, 12 –ø–æ—Ç–æ–∫–æ–≤, 48 GB RAM)

#### 6) Generation Layer

**LLM Router**:
- **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**:
  - YandexGPT RC (yandexgpt/rc) - –¥–µ—Ñ–æ–ª—Ç
  - GPT-5 - –±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
  - Deepseek - fallback
- **Fallback-–ª–æ–≥–∏–∫–∞**: –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω YandexGPT ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ GPT-5; –µ—Å–ª–∏ –∏ –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí Deepseek
- **Circuit Breaker**: –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º

**Prompt Composer**:
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏, —Å—Ç–∏–ª–µ–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- –û–ø–æ—Ä–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ retrieval

**Iterative RAG**:
- retrieve‚Üígenerate‚Üíretrieve –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã)

**–ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–≤–µ—Ç–æ–≤**:
- –û–¥–∏–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ streaming
- –í–∫–ª—é—á–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ (URL) –∏ —Å–ø–∏—Å–∫–∏
- –î–æ–±–∞–≤–ª—è—Ç—å —Å—Å—ã–ª–∫—É ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî —è–≤–Ω–æ —Å–æ–æ–±—â–∞—Ç—å –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ

#### 7) Storage (Qdrant)

**–ö–æ–ª–ª–µ–∫—Ü–∏—è**: `chatcenter_docs`
- **Named vectors**:
  - `dense` (1024 –∏–∑–º–µ—Ä–µ–Ω–∏—è, float32)
  - `sparse` (SparseVectorParams)
- **100% –ø–æ–∫—Ä—ã—Ç–∏–µ** sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**Payload (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)**:
- `url`, `title`, `breadcrumbs`, `section` (e.g., ¬´–ê–†–ú –∞–≥–µ–Ω—Ç–∞¬ª)
- `page_type` (api|faq|guide|release_notes)
- `version` (–¥–ª—è —Ä–µ–ª–∏–∑-–Ω–æ—Ç), `updated_at`, `hash`
- `anchors`, `headings`, `images`, `links`
- `source` (docs-site), `language` (ru), `product` (edna Chat Center)
- `doc_id`, `heading_path` - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- `text` - —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ chunk_text)

**–ò–Ω–¥–µ–∫—Å HNSW**:
- m=${QDRANT_HNSW_M}
- ef_construct=${QDRANT_HNSW_EF_CONSTRUCT}
- ef_search=${QDRANT_HNSW_EF_SEARCH}
- full_scan_threshold=${QDRANT_HNSW_FULL_SCAN_THRESHOLD}

#### 8) Observability & Evaluation

**Error Handling & Resilience**:
- **Comprehensive Error Handling**: Try-catch –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ pipeline —Å graceful degradation
- **Circuit Breaker**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (LLM, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, Qdrant)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: Marshmallow —Å—Ö–µ–º—ã –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/–∏–Ω—ä–µ–∫—Ü–∏–π
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π —Å burst protection

**Monitoring & Metrics**:
- **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—à–∏–±–æ–∫
- **HTTP —Å–µ—Ä–≤–µ—Ä –º–µ—Ç—Ä–∏–∫** –Ω–∞ –ø–æ—Ä—Ç—É 9001 –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- **Grafana dashboard** "RAG System Overview" —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **Admin endpoints** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**Quality System (RAGAS)**:
- **–ú–µ—Ç—Ä–∏–∫–∏ retrieval**: Context Relevance, Context Coverage, Precision@K, Recall@K
- **–ú–µ—Ç—Ä–∏–∫–∏ generation**: Answer Relevancy, Faithfulness, Completeness
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–∏–¥–±–µ–∫**: Inline –∫–Ω–æ–ø–∫–∏ –≤ Telegram –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
- **Quality Analytics**: REST API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
- **–û—Ñ–ª–∞–π–Ω-–æ—Ü–µ–Ω–∫–∞** –Ω–∞ golden set –∏ –æ–Ω–ª–∞–π–Ω-—Å–∏–≥–Ω–∞–ª—ã (user feedback, click-through –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

**Logging**:
- –õ–æ–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–∑–∞–ø—Ä–æ—Å, —Å—É—â–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞, –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –≤–µ—Å–∞, –æ—Ü–µ–Ω–∫–∏)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏

### –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–∞

1. **Channel Adapter** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí **Core API** `/v1/chat/query` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π
2. **Query Processing**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
3. **Embedding**: –ø–æ–ª—É—á–µ–Ω–∏–µ dense –∏ sparse –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∑–∞–ø—Ä–æ—Å–∞ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
4. **Retrieval**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ dense –∏ sparse –∑–∞–ø—Ä–æ—Å—ã –∫ Qdrant ‚Üí RRF ‚Üí metadata-boost ‚Üí bge-reranker
5. **Auto-Merge**: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ—Å–µ–¥–Ω–∏—Ö —á–∞–Ω–∫–æ–≤ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
6. **Context Optimization**: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–ø–∏—Å–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
7. **Generation**: –≤—ã–±–æ—Ä LLM –ø–æ —Ä–æ—É—Ç–∏–Ω–≥—É –∏ fallback, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ top-k –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
8. **Postprocess**: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Å–ø–∏—Å–æ–∫ `url` + –∑–∞–≥–æ–ª–æ–≤–∫–∏), —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ/—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
9. **Delivery**: –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Channel Adapter (Telegram)
10. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∑–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, Circuit Breaker –ø—Ä–æ–≤–µ—Ä–∫–∏
11. **Quality Feedback**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –î–∏–∑–∞–π–Ω –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)

```python
# adapters/channel.py
class ChannelAdapter(Protocol):
    def send_message(self, chat_id: str, text: str) -> None: ...
    def send_rich_answer(self, chat_id: str, answer: dict) -> None: ...

# app/services/core/embeddings.py
def embed_dense(text: str) -> list[float]: ...  # BGE-M3 via ONNX
def embed_sparse(text: str) -> dict[str, float]: ...  # BGE-M3 sparse

# app/services/search/retrieval.py
def hybrid_search(query_dense: list[float], query_sparse: dict[str, float], k: int, boosts: dict) -> list[dict]: ...

# app/services/search/rerank.py
def rerank(query: str, candidates: list[dict], top_n: int) -> list[dict]: ...  # bge-reranker-v2-m3

# app/services/core/llm_router.py
def generate_answer(query: str, context: list[dict], policy: dict) -> str: ...

# ingestion/run.py
def run_ingestion(source: str, config: dict) -> dict: ...
```

### Qdrant: —Å—Ö–µ–º–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –∑–∞–ø—Ä–æ—Å—ã

**–ö–æ–ª–ª–µ–∫—Ü–∏—è** `chatcenter_docs`:
- Named vectors: `dense: float32[1024]`, `sparse: SparseVector`
- Payload: –ø–æ–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- 100% –ø–æ–∫—Ä—ã—Ç–∏–µ sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏

**–ü—Ä–∏–º–µ—Ä –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞** (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):
```python
client.search(
    collection_name="chatcenter_docs",
    query_vector=("dense", dense_vec),
    query_sparse=SparseVector(indices, values),
    with_payload=True,
    limit=k,
    params={"hnsw_ef": EF_SEARCH}
)
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ `env.example`):

**Qdrant**:
- QDRANT_URL, QDRANT_API_KEY, QDRANT_COLLECTION
- QDRANT_HNSW_M, QDRANT_HNSW_EF_CONSTRUCT, QDRANT_HNSW_EF_SEARCH, QDRANT_HNSW_FULL_SCAN_THRESHOLD

**–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**:
- EMBEDDINGS_BACKEND=auto, EMBEDDING_DEVICE=auto, USE_SPARSE=true
- BGE_MODEL_NAME, BGE_ONNX_MODEL_PATH, BGE_EMBEDDING_DIM

**–ß–∞–Ω–∫–∏–Ω–≥**:
- CHUNK_MIN_TOKENS=150, CHUNK_MAX_TOKENS=300 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- CHUNK_OVERLAP_BASE=100

**LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**:
- DEEPSEEK_API_URL, DEEPSEEK_API_KEY, DEEPSEEK_MODEL
- YANDEX_API_URL, YANDEX_CATALOG_ID, YANDEX_API_KEY, YANDEX_MODEL, YANDEX_MAX_TOKENS
- GPT5_API_URL, GPT5_API_KEY, GPT5_MODEL

**Telegram**:
- TELEGRAM_BOT_TOKEN, TELEGRAM_POLL_INTERVAL

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- REDIS_URL, CACHE_ENABLED, CACHE_TTL

**–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**:
- DOCS_ROOT_PATH (–ø—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Docusaurus)
- SITE_BASE_URL (–±–∞–∑–æ–≤—ã–π URL —Å–∞–π—Ç–∞)
- SITE_DOCS_PREFIX (–ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- MAX_MESSAGE_LENGTH, ALLOWED_CHANNELS
- RATE_LIMIT_REQUESTS, RATE_LIMIT_WINDOW

### ADR (–∫–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è)

1. **Qdrant** –∫–∞–∫ –µ–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–ª—è dense+sparse ‚Üí —É–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç–µ–∫–∞ –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª
2. **BGE-M3**: dense ‚Üí ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ); sparse ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ BGE-M3 –Ω–∞ CPU
3. **RRF + bge-reranker-v2-m3** (Hybrid CPU+GPU, 12 –ø–æ—Ç–æ–∫–æ–≤): —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞ (0.5/0.5), —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é A/B-—Ç–µ—Å—Ç–∞
4. **–ï–¥–∏–Ω–∞—è DAG –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤ ‚Üí —É–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
5. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –ø–æ hash/updated_at —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º ‚Üí –±—ã—Å—Ç—Ä—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
6. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞** –ø–æ—à–∞–≥–æ–≤–æ–≥–æ RAG (max_depth=3) ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
7. **Comprehensive Error Handling**: Try-catch –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —Å graceful degradation
8. **Circuit Breaker Pattern**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
9. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback ‚Üí –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
10. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: Marshmallow —Å—Ö–µ–º—ã ‚Üí –∑–∞—â–∏—Ç–∞ –æ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
11. **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
12. **Sparse –≤–µ–∫—Ç–æ—Ä—ã**: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å 100% –ø–æ–∫—Ä—ã—Ç–∏–µ–º
13. **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥**: 150-300 —Ç–æ–∫–µ–Ω–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
14. **–ï–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: –ó–∞–º–µ–Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–¥–Ω–∏–º production-ready –º–æ–¥—É–ª–µ–º
15. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è payload**: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ ‚Üí —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞ –≤ 2 —Ä–∞–∑–∞

### API Endpoints

#### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
- **`POST /v1/chat/query`** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—Ä–æ—Å–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π
- **`POST /v1/admin/reindex`** ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`GET /apidocs`** ‚Äî Swagger UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- **`GET /apispec_1.json`** ‚Äî OpenAPI 2.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- **`GET /v1/admin/health`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å Circuit Breakers –∏ –∫—ç—à–µ–º
- **`GET /v1/admin/metrics`** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ Prometheus –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- **`GET /v1/admin/metrics/raw`** ‚Äî —Å—ã—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **`GET /v1/admin/circuit-breakers`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ Circuit Breakers
- **`POST /v1/admin/circuit-breakers/reset`** ‚Äî —Å–±—Ä–æ—Å Circuit Breakers
- **`GET /v1/admin/cache`** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
- **`POST /v1/admin/metrics/reset`** ‚Äî —Å–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

#### –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Prometheus** (–ø–æ—Ä—Ç 9090) ‚Äî —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å RAG API
- **Grafana** (–ø–æ—Ä—Ç 8080) ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **HTTP —Å–µ—Ä–≤–µ—Ä –º–µ—Ç—Ä–∏–∫** (–ø–æ—Ä—Ç 9001) ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- **–ì–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥** "RAG System Overview" —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Docker Compose

#### Rate Limiting
- **`GET /v1/admin/rate-limiter`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ Rate Limiter
- **`GET /v1/admin/rate-limiter/<user_id>`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`POST /v1/admin/rate-limiter/<user_id>/reset`** ‚Äî —Å–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **`GET /v1/admin/security`** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **`GET /v1/admin/security/user/<user_id>`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`POST /v1/admin/security/user/<user_id>/block`** ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### Quality System
- **`POST /v1/admin/quality/feedback`** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
- **`GET /v1/quality/analytics`** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
- **`GET /v1/quality/trends`** ‚Äî —Ç—Ä–µ–Ω–¥—ã –∫–∞—á–µ—Å—Ç–≤–∞

#### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- **`rag_queries_total`** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º
- **`rag_query_duration_seconds`** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **`rag_embedding_duration_seconds`** ‚Äî –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **`rag_search_duration_seconds`** ‚Äî –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
- **`rag_llm_duration_seconds`** ‚Äî –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LLM
- **`rag_cache_hits_total`** ‚Äî –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
- **`rag_errors_total`** ‚Äî –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
- **`rag_quality_score`** ‚Äî –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (v4.3.0)

```
RAG_clean/
‚îú‚îÄ‚îÄ ingestion/                    # üèóÔ∏è –ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ adapters/                 # üîå –ê–¥–∞–ø—Ç–µ—Ä—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (SourceAdapter, PipelineStep)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docusaurus.py        # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è Docusaurus —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ website.py           # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ normalizers/              # üßπ –ü–ª–∞–≥–∏–Ω—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ë–∞–∑–æ–≤—ã–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docusaurus.py        # Docusaurus-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ html.py              # HTML –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ pipeline/                 # üß© –®–∞–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dag.py               # –ï–¥–∏–Ω—ã–π DAG –ø–∞–π–ø–ª–∞–π–Ω
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunker.py           # –®–∞–≥ —á–∞–Ω–∫–∏–Ω–≥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embedder.py          # –®–∞–≥ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ indexers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ qdrant_writer.py # –ï–¥–∏–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å –≤ Qdrant
‚îÇ   ‚îú‚îÄ‚îÄ state/                    # üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ state_manager.py     # –ï–¥–∏–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # üì¶ –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docusaurus_utils.py  # –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã Docusaurus
‚îÇ   ‚îú‚îÄ‚îÄ crawlers/                 # üï∑Ô∏è –ö—Ä–∞—É–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docusaurus_fs_crawler.py # –§–∞–π–ª–æ–≤—ã–π –∫—Ä–∞—É–ª–µ—Ä Docusaurus
‚îÇ   ‚îú‚îÄ‚îÄ chunking/                 # üß© –ß–∞–Ω–∫–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ universal_chunker.py # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —á–∞–Ω–∫–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ run.py                    # üöÄ –ï–¥–∏–Ω—ã–π entrypoint
‚îÇ   ‚îú‚îÄ‚îÄ indexer.py               # üì¶ –ü—Ä–æ—Å—Ç–æ–π –∏–Ω–¥–µ–∫—Å–µ—Ä (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml              # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ app/                          # üèóÔ∏è –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # üîß –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/                # –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (embeddings, llm_router, query_processing, context_optimizer)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search/              # –ü–æ–∏—Å–∫ (retrieval, rerank)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quality/             # –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ (quality_manager, ragas_evaluator)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/      # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (orchestrator, connection_pool)
‚îÇ   ‚îú‚îÄ‚îÄ routes/                   # üõ£Ô∏è API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.py              # –ß–∞—Ç endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py             # –ê–¥–º–∏–Ω endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ quality.py           # Quality endpoints
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ config/                   # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ validation.py            # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ caching.py               # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ circuit_breaker.py       # Circuit Breaker
‚îÇ   ‚îî‚îÄ‚îÄ metrics.py               # Prometheus –º–µ—Ç—Ä–∏–∫–∏
‚îú‚îÄ‚îÄ adapters/                     # üîå Channel Adapters
‚îÇ   ‚îî‚îÄ‚îÄ telegram/                # Telegram –∞–¥–∞–ø—Ç–µ—Ä
‚îÇ       ‚îú‚îÄ‚îÄ telegram_adapter.py  # –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–∞–ø—Ç–µ—Ä
‚îÇ       ‚îî‚îÄ‚îÄ html_renderer.py     # HTML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ tests/                        # üß™ –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_unified_*           # –¢–µ—Å—Ç—ã –µ–¥–∏–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_docusaurus_*        # –¢–µ—Å—Ç—ã Docusaurus –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ services/                # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ scripts/                      # üìú –£—Ç–∏–ª–∏—Ç–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ docs/                        # üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ k8s/                         # ‚ò∏Ô∏è Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ monitoring/                  # üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ prometheus.yml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ grafana/                 # Grafana –¥–∞—à–±–æ—Ä–¥—ã
‚îú‚îÄ‚îÄ docker-compose.yml           # üê≥ Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt             # üì¶ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example                 # üîß –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                    # üìñ –ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (Docusaurus)

```bash
# –ü–æ–ª–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å –æ—á–∏—Å—Ç–∫–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏
python ingestion/run.py docusaurus \
    --docs-root docs \
    --reindex-mode full \
    --clear-collection

# –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
python ingestion/run.py docusaurus \
    --docs-root docs \
    --reindex-mode incremental

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —á–∞–Ω–∫–∏–Ω–≥–∞
python ingestion/run.py docusaurus \
    --docs-root docs \
    --chunk-min-tokens 150 \
    --chunk-max-tokens 300 \
    --reindex-mode full
```

#### –ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (Website)

```bash
python ingestion/run.py website \
    --seed-urls "https://example.com" \
    --max-depth 3 \
    --reindex-mode full
```

#### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
curl -X POST http://localhost:5001/admin/reindex \
     -H "Content-Type: application/json" \
     -d '{"force_full": true}'

# –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
curl -X POST http://localhost:5001/admin/reindex \
     -H "Content-Type: application/json" \
     -d '{"incremental": true}'
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –∏ –ø–∞—Ä—Å–∏–Ω–≥ (–ø—É–ª—ã –≤–æ—Ä–∫–µ—Ä–æ–≤)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π chunking**: –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —É—á–µ—Ç–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–ë–∞—Ç—á–µ–≤–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ** —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HNSW** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥ –æ–±—ä—ë–º (–∏–∑ ENV)
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** Core API –∑–∞ —Å—á—ë—Ç stateless –¥–∏–∑–∞–π–Ω–∞
- **Circuit Breaker** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Rate Limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Graceful degradation** –ø—Ä–∏ —Å–±–æ—è—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è payload**: —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ‚Üí —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞ –≤ 2 —Ä–∞–∑–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ö–ª—é—á–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ `.env` (–¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`), –ø—Ä–∏–º–µ—Ä—ã –≤ `env.example`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: Marshmallow —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö API endpoints
- **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/–∏–Ω—ä–µ–∫—Ü–∏–π
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π —Å burst protection
- **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏
- **–ê–ª–µ—Ä—Ç—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö

### –ë—É–¥—É—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö `ChannelAdapter`: Web-–≤–∏–¥–∂–µ—Ç –∏ edna API Bot Connect
- –ï–¥–∏–Ω—ã–π `/v1/chat/query` –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –±–ª–æ–≥–∏, FAQ)
- –£–ª—É—á—à–µ–Ω–∏–µ Quality System —Å ML-–º–æ–¥–µ–ª—è–º–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π retrieval –∏ generation
