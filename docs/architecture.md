## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è edna Chat Center

### –¶–µ–ª–∏
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –ø—Ä–æ–¥—É–∫—Ç–µ edna Chat Center —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (—Å—Ç–∞—Ä—Ç —Å Telegram; –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Web/Widget, email, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–Ω–µ–ª–∏).
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (dense + sparse) –≤ Qdrant, RRF –∏ ML-—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ (bge-reranker-v2-m3).
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è HTML-–ø–æ—Ä—Ç–∞–ª–∞ `https://docs-chatcenter.edna.ru/` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —á–∞–Ω–∫–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ (retrieval + generation), —Å fallback –ª–æ–≥–∏–∫–æ–π LLM.

### üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (v3.0.0)

**–ö—Ä—É–ø–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!** –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

- **üèóÔ∏è –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ services/** - –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **üß© UnifiedChunker** - –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö chunking –æ–ø–µ—Ä–∞—Ü–∏–π
- **üîß GPU Manager** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä GPU –æ–ø–µ—Ä–∞—Ü–∏–π
- **üï∑Ô∏è –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ crawlers** - —Ñ–∞–±—Ä–∏—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **üßπ TextProcessor** - –µ–¥–∏–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–µ–∫—Å—Ç–æ–º
- **üìä MetadataExtractor** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- **üì± Telegram Adapters** - —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- **üì¶ ContentLoader** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **üèóÔ∏è –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ app/** - –ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **üìà –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –¥–æ 40% –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- **üóëÔ∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - —É–¥–∞–ª–µ–Ω–æ 3,150 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1) Channel Adapters (–≤–Ω–µ—à–Ω–∏–µ –∫–∞–Ω–∞–ª—ã)
   - Telegram Adapter (long polling): —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –≤ Core API/–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä.
   - –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è `ChannelAdapter` –¥–ª—è –±—É–¥—É—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤: Web-–≤–∏–¥–∂–µ—Ç, edna API Bot Connect (email/WhatsApp ‚Äî –ø–æ–∑–∂–µ, –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

2) Core API (Flask)
   - REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
     - `POST /v1/chat/query` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—Ä–æ—Å–∞ (–¥–ª—è –ª—é–±—ã—Ö –∫–∞–Ω–∞–ª–æ–≤, –≤ —Ç.—á. Telegram-–ø–æ–ª–ª–∏–Ω–≥ –≤–æ—Ä–∫–µ—Ä).
     - `POST /v1/admin/reindex` ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (cron ‚Äî –ø–æ–∑–∂–µ).
   - –û—Ä–∫–µ—Å—Ç—Ä–æ–≤–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞: Query Processing ‚Üí Retrieval ‚Üí Rerank ‚Üí Generation ‚Üí Postprocess.

3) Query Processing
   - Entity Extraction: –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–æ–º–µ–Ω–∞ (—Ä–∞–∑–¥–µ–ª—ã –ø–æ—Ä—Ç–∞–ª–∞: ¬´–ê–†–ú –∞–≥–µ–Ω—Ç–∞¬ª, ¬´API¬ª –∏ —Ç.–ø.).
   - Query Rewriting/Normalization: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –≤–æ–ø—Ä–æ—Å–∞ (—Å–∏–Ω–æ–Ω–∏–º—ã, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π).
   - Query Decomposition: –ø–æ—à–∞–≥–æ–≤–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, max_depth=3).

4) Retrieval Layer
   - HybridRetriever –¥–ª—è Qdrant:
     - Dense-–≤–µ–∫—Ç–æ—Ä—ã: BGE-M3 —á–µ—Ä–µ–∑ ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ) –∏–ª–∏ CPU fallback.
     - Sparse-–≤–µ–∫—Ç–æ—Ä—ã: BGE-M3 sparse (–ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ BGE-M3 –Ω–∞ CPU). –•—Ä–∞–Ω–µ–Ω–∏–µ –≤–º–µ—Å—Ç–µ —Å dense –≤ Qdrant –∫–∞–∫ named vectors.
   - Fusion: RRF (Reciprocal Rank Fusion) –ø–æ–≤–µ—Ä—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ dense –∏ sparse.
   - Metadata-boost: —É—á–µ—Ç `page_type` (API/FAQ/guide/release_notes), —Å–≤–µ–∂–µ—Å—Ç–∏ `release_notes` –∏ —Ñ–æ—Ä–º—ã –≤–æ–ø—Ä–æ—Å–∞ (–≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ ‚Äî boost FAQ).
   - –†–µ—Ä–∞–Ω–∫–∏–Ω–≥ (–≤—Ç–æ—Ä–æ–π —à–∞–≥): bge-reranker-v2-m3 –ø–æ top-N (–Ω–∞–ø—Ä–∏–º–µ—Ä, N=30 ‚Üí —Ç–æ–ø-10).
   - –†–µ—Å—É—Ä—Å—ã: Hybrid CPU+GPU –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (DirectML –¥–ª—è dense, CPU –¥–ª—è sparse, 12 –ø–æ—Ç–æ–∫–æ–≤, 48 GB RAM). –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ —á–∏—Å–ª—É –ø–æ—Ç–æ–∫–æ–≤.

5) Generation Layer
   - LLM Router:
     - –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã: YandexGPT RC (yandexgpt/rc - –¥–µ—Ñ–æ–ª—Ç), GPT-5 (–±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ), Deepseek (fallback).
     - Fallback-–ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω YandexGPT ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ GPT-5; –µ—Å–ª–∏ –∏ –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî Deepseek.
   - Prompt Composer: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏, —Å—Ç–∏–ª–µ–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –Ω–∞ –æ–ø–æ—Ä—É –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
   - Iterative RAG (retrieve‚Üígenerate‚Üíretrieve) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã).
   - –ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–≤–µ—Ç–æ–≤: –æ–¥–∏–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ streaming; –≤–∫–ª—é—á–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ (URL) –∏ —Å–ø–∏—Å–∫–∏; –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Å—ã–ª–∫—É ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é; –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî —è–≤–Ω–æ —Å–æ–æ–±—â–∞—Ç—å –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ.

6) Ingestion & Indexing
   - **–ï–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** (`scripts/indexer.py`): Production-ready –º–æ–¥—É–ª—å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
     - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤: full, incremental, cache_only
     - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
     - –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
   - **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö** (`app/sources_registry.py`):
     - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `SourceConfig`
     - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–∏–ø–æ–≤: –≤–µ–±-—Å–∞–π—Ç—ã, –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏, API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –±–ª–æ–≥–∏, FAQ
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
     - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - **–ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—Ä–∞—É–ª–µ—Ä–æ–≤** (`ingestion/crawlers/`):
     - `BaseCrawler` - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∞—É–ª–µ—Ä–æ–≤
     - `WebsiteCrawler` - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –±–ª–æ–≥–∏, API docs)
     - `LocalFolderCrawler` - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
     - `CrawlerFactory` - —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∫—Ä–∞—É–ª–µ—Ä–∞
     - –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
   - HTML Crawler –¥–ª—è `docs-chatcenter.edna.ru` (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º sitemap.xml –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è).
   - Specialized Parsers:
     - API docs: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ endpoints/parameters/examples/responses.
     - Release Notes: version/features/fixes/breaking_changes + –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å–≤–µ–∂–∏—Ö –≤–µ—Ä—Å–∏–π.
     - FAQ: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ QA-–ø–∞—Ä.
     - Guides/Manuals: –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã, —Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏, —Å—Å—ã–ª–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (alt/figcaption).
   - Chunker —Å Quality Gates:
     - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ: 60-250 —Ç–æ–∫–µ–Ω–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –∏ –ø—Ä–æ—Å—Ç—ã–º —á–∞–Ω–∫–∏–Ω–≥–æ–º.
     - –ö–æ–Ω—Ç—Ä–æ–ª—å min/max –¥–ª–∏–Ω—ã (–≤ —Ç–æ–∫–µ–Ω–∞—Ö), no-empty, deduplication (hash/SimHash/MinHash –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ).
     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–∏–µ—Ä–∞—Ä—Ö–∏—è H1‚ÄìH6) –∏ —Ç–∞–±–ª–∏—Ü.
   - Embedding Service:
     - Dense: BGE-M3 —á–µ—Ä–µ–∑ ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ) ‚Üí –≤–µ–∫—Ç–æ—Ä.
     - Sparse: BGE-M3 sparse (–ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ CPU) ‚Üí —Å–ª–æ–≤–∞—Ä—å {term: weight}.
   - Qdrant Writer:
     - –ì–∏–±—Ä–∏–¥–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å named vectors: dense-–≤–µ–∫—Ç–æ—Ä, sparse-–≤–µ–∫—Ç–æ—Ä, payload.
     - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö—ç—à–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞/updated_at; upsert –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤, —É–¥–∞–ª–µ–Ω–∏–µ —É–±—ã–≤—à–∏—Ö. –ó–∞–ø—É—Å–∫ –ø–æ–∫–∞ –≤—Ä—É—á–Ω—É—é (cron –ø–æ–∑–∂–µ).
   - –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ö–æ–¥–∞ –∫—Ä–∞—É–ª–∏–Ω–≥–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (CLI –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å sitemap-based –ø–æ–¥—Å—á–µ—Ç–æ–º).

7) Storage (Qdrant)
   - –ö–æ–ª–ª–µ–∫—Ü–∏—è: `chatcenter_docs`
     - Named vectors: `dense` (1024 –∏–∑–º–µ—Ä–µ–Ω–∏—è) –∏ `sparse` (SparseVectorParams).
     - 100% –ø–æ–∫—Ä—ã—Ç–∏–µ sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏ (512/512 —Ç–æ—á–µ–∫ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏ dense, –∏ sparse –≤–µ–∫—Ç–æ—Ä—ã).
     - Payload (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ):
       - `url`, `title`, `breadcrumbs`, `section` (e.g., ¬´–ê–†–ú –∞–≥–µ–Ω—Ç–∞¬ª), `page_type` (api|faq|guide|release_notes),
       - `version` (–¥–ª—è —Ä–µ–ª–∏–∑-–Ω–æ—Ç), `updated_at`, `hash`, `anchors`, `headings`, `images`, `links`.
       - `source` (docs-site), `language` (ru), `product` (edna Chat Center).
   - –ò–Ω–¥–µ–∫—Å HNSW:
     - m=${QDRANT_HNSW_M}, ef_construct=${QDRANT_HNSW_EF_CONSTRUCT}, ef_search=${QDRANT_HNSW_EF_SEARCH}, full_scan_threshold=${QDRANT_HNSW_FULL_SCAN_THRESHOLD}.

8) Observability & Evaluation
   - **Comprehensive Error Handling**: Try-catch –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ pipeline —Å graceful degradation
   - **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—à–∏–±–æ–∫
   - **Circuit Breaker**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (LLM, —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, Qdrant)
   - **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
   - **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: Marshmallow —Å—Ö–µ–º—ã –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/–∏–Ω—ä–µ–∫—Ü–∏–π
   - –õ–æ–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ (–∑–∞–ø—Ä–æ—Å, —Å—É—â–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞, –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –≤–µ—Å–∞, –æ—Ü–µ–Ω–∫–∏)
   - –ú–µ—Ç—Ä–∏–∫–∏ retrieval: Context Relevance, Context Coverage, Precision@K, Recall@K
   - –ú–µ—Ç—Ä–∏–∫–∏ generation: Answer Relevancy, Faithfulness, Completeness
   - –û—Ñ–ª–∞–π–Ω-–æ—Ü–µ–Ω–∫–∞ –Ω–∞ golden set (–∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è) –∏ –æ–Ω–ª–∞–π–Ω-—Å–∏–≥–Ω–∞–ª—ã (user feedback, click-through –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
   - HTTP —Å–µ—Ä–≤–µ—Ä –º–µ—Ç—Ä–∏–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8000, admin endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–∞
1) **Channel Adapter** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí **Core API** `/v1/chat/query` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π
2) **Query Processing**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
3) **Embedding**: –ø–æ–ª—É—á–µ–Ω–∏–µ dense –∏ sparse –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∑–∞–ø—Ä–æ—Å–∞ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
4) **Retrieval**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ dense –∏ sparse –∑–∞–ø—Ä–æ—Å—ã –∫ Qdrant ‚Üí RRF ‚Üí metadata-boost ‚Üí bge-reranker
5) **Generation**: –≤—ã–±–æ—Ä LLM –ø–æ —Ä–æ—É—Ç–∏–Ω–≥—É –∏ fallback, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ top-k –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
6) **Postprocess**: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Å–ø–∏—Å–æ–∫ `url` + –∑–∞–≥–æ–ª–æ–≤–∫–∏), —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ/—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
7) **Delivery**: –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Channel Adapter (Telegram)
8) **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∑–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, Circuit Breaker –ø—Ä–æ–≤–µ—Ä–∫–∏

### –î–∏–∑–∞–π–Ω –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
```python
# adapters/channel.py
class ChannelAdapter(Protocol):
    def send_message(self, chat_id: str, text: str) -> None: ...
    def send_rich_answer(self, chat_id: str, answer: dict) -> None: ...

# services/bge_embeddings.py
def embed_dense(text: str) -> list[float]: ...  # via Ollama (BGE-M3)
def embed_sparse(text: str) -> dict[str, float]: ...  # via FlagEmbedding (BGE-M3 sparse)

# services/retrieval.py
def hybrid_search(query_dense: list[float], query_sparse: dict[str, float], k: int, boosts: dict) -> list[dict]: ...

# services/rerank.py
def rerank(query: str, candidates: list[dict], top_n: int) -> list[dict]: ...  # bge-reranker-v2-m3

# services/llm_router.py
def generate_answer(query: str, context: list[dict], policy: dict) -> str: ...

# ingestion/pipeline.py
def crawl_and_index(incremental: bool = True) -> dict: ...
```

### Qdrant: —Å—Ö–µ–º–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –∑–∞–ø—Ä–æ—Å—ã
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `chatcenter_docs`:
  - Named vectors: `dense: float32[1024]`, `sparse: SparseVector`
  - payload: –ø–æ–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
  - 100% –ø–æ–∫—Ä—ã—Ç–∏–µ sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏

- –ü—Ä–∏–º–µ—Ä –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):
```python
client.search(collection_name,
    query_vector=("dense", dense_vec),
    query_sparse=SparseVector(indices, values),
    with_payload=True,
    limit=k,
    params={"hnsw_ef": EF_SEARCH})
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ `env.example`):
  - **Qdrant**: QDRANT_URL, QDRANT_API_KEY, QDRANT_HNSW_M, QDRANT_HNSW_EF_CONSTRUCT, QDRANT_HNSW_EF_SEARCH, QDRANT_HNSW_FULL_SCAN_THRESHOLD
  - **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: EMBEDDINGS_BACKEND=auto, EMBEDDING_DEVICE=auto, USE_SPARSE=true
  - **LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**: DEEPSEEK_API_URL, DEEPSEEK_API_KEY, DEEPSEEK_MODEL, YANDEX_API_URL, YANDEX_CATALOG_ID, YANDEX_API_KEY, YANDEX_MODEL, YANDEX_MAX_TOKENS, GPT5_API_URL, GPT5_API_KEY, GPT5_MODEL
  - **Telegram**: TELEGRAM_BOT_TOKEN, TELEGRAM_POLL_INTERVAL
  - **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: REDIS_URL, CACHE_ENABLED
  - **–ö—Ä–∞—É–ª–∏–Ω–≥**: CRAWL_START_URL, CRAWL_CONCURRENCY, CRAWL_TIMEOUT_S, CRAWL_MAX_PAGES, CRAWL_DELAY_MS, CRAWL_JITTER_MS, CRAWL_STRATEGY
  - **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: MAX_MESSAGE_LENGTH, ALLOWED_CHANNELS, RATE_LIMIT_REQUESTS, RATE_LIMIT_WINDOW

### ADR (–∫–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è)
1) **Qdrant** –∫–∞–∫ –µ–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–ª—è dense+sparse ‚Üí —É–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç–µ–∫–∞ –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª
2) **BGE-M3**: dense ‚Üí ONNX —Å DirectML (GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ); sparse ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ BGE-M3 –Ω–∞ CPU. –•—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–æ–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∫–∞–∫ named vectors
3) **RRF + bge-reranker-v2-m3** (Hybrid CPU+GPU, 12 –ø–æ—Ç–æ–∫–æ–≤): —Å—Ç–∞—Ä—Ç —Ä–∞–≤–Ω—ã–µ –≤–µ—Å–∞ (0.5/0.5), –∑–∞—Ç–µ–º A/B-—Ç–µ—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä 0.6/0.4)
4) **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –ø–æ hash/updated_at –∏ –¥–∏—Ñ—Ñ-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ sitemap-based –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º; –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (cron –ø–æ–∑–¥–Ω–µ–µ)
5) **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞** –ø–æ—à–∞–≥–æ–≤–æ–≥–æ RAG (max_depth=3) –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
6) **Comprehensive Error Handling**: Try-catch –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —Å graceful degradation –∏ fallback –ª–æ–≥–∏–∫–æ–π
7) **Circuit Breaker Pattern**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
8) **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
9) **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: Marshmallow —Å—Ö–µ–º—ã –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/–∏–Ω—ä–µ–∫—Ü–∏–π
10) **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –æ—à–∏–±–æ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
11) **Sparse –≤–µ–∫—Ç–æ—Ä—ã**: –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å 100% –ø–æ–∫—Ä—ã—Ç–∏–µ–º sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏ (512/512 —Ç–æ—á–µ–∫)
12) **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —á–∞–Ω–∫–∏–Ω–≥**: 60-250 —Ç–æ–∫–µ–Ω–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
13) **–ï–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: –ó–∞–º–µ–Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–¥–Ω–∏–º production-ready –º–æ–¥—É–ª–µ–º —Å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –∏ –ø–∞—Ä—Å–∏–Ω–≥ (–ø—É–ª—ã –≤–æ—Ä–∫–µ—Ä–æ–≤)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + in-memory fallback –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ chunking**: –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–æ–¥—Å—Ç–≤–∞
- **–ë–∞—Ç—á–µ–≤–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ** —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ HNSW** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥ –æ–±—ä—ë–º (–∏–∑ ENV)
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** Core API –∑–∞ —Å—á—ë—Ç stateless –¥–∏–∑–∞–π–Ω–∞
- **Circuit Breaker** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Rate Limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Graceful degradation** –ø—Ä–∏ —Å–±–æ—è—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ö–ª—é—á–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ `.env` (–¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`), –ø—Ä–∏–º–µ—Ä—ã ‚Äî –≤ `env.example` –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: Marshmallow —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö API endpoints
- **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/–∏–Ω—ä–µ–∫—Ü–∏–π
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π —Å burst protection
- **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏
- **–ê–ª–µ—Ä—Ç—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- –ü—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–æ–≤ ‚Äî –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### API Endpoints

#### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
- **`POST /v1/chat/query`** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—Ä–æ—Å–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π
- **`POST /v1/admin/reindex`** ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`GET /apidocs`** ‚Äî Swagger UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- **`GET /apispec_1.json`** ‚Äî OpenAPI 2.0 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- **`GET /v1/admin/health`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å Circuit Breakers –∏ –∫—ç—à–µ–º
- **`GET /v1/admin/metrics`** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ Prometheus –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- **`GET /v1/admin/metrics/raw`** ‚Äî —Å—ã—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **`GET /v1/admin/circuit-breakers`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ Circuit Breakers
- **`POST /v1/admin/circuit-breakers/reset`** ‚Äî —Å–±—Ä–æ—Å Circuit Breakers
- **`GET /v1/admin/cache`** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
- **`POST /v1/admin/metrics/reset`** ‚Äî —Å–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

#### –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Prometheus** (–ø–æ—Ä—Ç 9090) ‚Äî —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å RAG API
- **Grafana** (–ø–æ—Ä—Ç 8080) ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **HTTP —Å–µ—Ä–≤–µ—Ä –º–µ—Ç—Ä–∏–∫** (–ø–æ—Ä—Ç 9001) ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- **–ì–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥** "RAG System Overview" —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Docker Compose

#### Rate Limiting
- **`GET /v1/admin/rate-limiter`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ Rate Limiter
- **`GET /v1/admin/rate-limiter/<user_id>`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`POST /v1/admin/rate-limiter/<user_id>/reset`** ‚Äî —Å–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **`GET /v1/admin/security`** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **`GET /v1/admin/security/user/<user_id>`** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`POST /v1/admin/security/user/<user_id>/block`** ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- **`rag_queries_total`** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∏ —Å—Ç–∞—Ç—É—Å–∞–º
- **`rag_query_duration_seconds`** ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **`rag_embedding_duration_seconds`** ‚Äî –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **`rag_search_duration_seconds`** ‚Äî –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
- **`rag_llm_duration_seconds`** ‚Äî –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LLM
- **`rag_cache_hits_total`** ‚Äî –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à
- **`rag_errors_total`** ‚Äî –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

#### Grafana –¥–∞—à–±–æ—Ä–¥—ã
- **RAG System Overview** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
- **Query Performance** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Cache Analytics** ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Error Monitoring** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏ –∏—Ö —Ç–∏–ø–æ–≤
- **System Health** ‚Äî –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ –∏ sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- **–ï–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**: `scripts/indexer.py` - production-ready –º–æ–¥—É–ª—å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤: full, incremental, cache_only
  - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
- **–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏**: `scripts/indexer.py init --recreate` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π sparse –≤–µ–∫—Ç–æ—Ä–æ–≤
- **–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: `scripts/indexer.py reindex --mode full` –¥–ª—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è**: `scripts/indexer.py status` –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ 100% –ø–æ–∫—Ä—ã—Ç–∏—è sparse –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–∫—Ä–∏–ø—Ç `test_sparse_search_detailed.py` –¥–ª—è comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è sparse –ø–æ–∏—Å–∫–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º**: –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞ –∫—Ä–∞—É–ª–∏–Ω–≥–∞
- **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤**: `scripts/cleanup_old_scripts.py` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### –ë—É–¥—É—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö `ChannelAdapter`: Web-–≤–∏–¥–∂–µ—Ç –∏ edna API Bot Connect (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ)
- –ï–¥–∏–Ω—ã–π `/v1/chat/query` –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º
