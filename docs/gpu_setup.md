# GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è Radeon RX 6700 XT

## üéØ –û–±–∑–æ—Ä

RAG-—Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è AMD Radeon RX 6700 XT —á–µ—Ä–µ–∑ ROCm (Radeon Open Compute). –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, reranking –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ chunking.

## üöÄ –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ

- **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: 3-5x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **Reranking**: 2-4x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π chunking**: 2-3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **–û–±—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2-4x —É—Å–∫–æ—Ä–µ–Ω–∏–µ

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **OS**: Ubuntu 20.04+ –∏–ª–∏ Windows 11
- **GPU**: AMD Radeon RX 6700 XT (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)
- **RAM**: 16GB+ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **VRAM**: 8GB+ (–¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π)

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
- **ROCm 5.7+** - –¥–ª—è AMD GPU
- **PyTorch —Å ROCm** - –¥–ª—è GPU –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **Python 3.8+** - –¥–ª—è RAG —Å–∏—Å—Ç–µ–º—ã

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ROCm (Ubuntu)

```bash
# –°–∫–∞—á–∏–≤–∞–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ROCm
wget https://repo.radeon.com/amdgpu-install/5.7/ubuntu/jammy/amdgpu-install_5.7.50700-1_all.deb
sudo dpkg -i amdgpu-install_5.7.50700-1_all.deb
sudo apt-get update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ROCm
sudo amdgpu-install --usecase=rocm

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
rocm-smi
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch —Å ROCm

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PyTorch —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ROCm
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/rocm5.7

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
pip install transformers[torch] accelerate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ RAG —Å–∏—Å—Ç–µ–º—ã

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd RAG_2

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è GPU
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

```bash
# GPU Configuration
GPU_ENABLED=true
GPU_DEVICE=0
GPU_MEMORY_FRACTION=0.8

# Reranker –Ω–∞ GPU
RERANKER_DEVICE=cuda

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç GPU
python scripts/test_gpu_performance.py

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPU
python -c "import torch; print(f'CUDA –¥–æ—Å—Ç—É–ø–µ–Ω: {torch.cuda.is_available()}'); print(f'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ GPU: {torch.cuda.device_count()}')"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python scripts/test_gpu_performance.py
```

### 2. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º GPU
import torch
print(f"CUDA –¥–æ—Å—Ç—É–ø–µ–Ω: {torch.cuda.is_available()}")
print(f"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {torch.cuda.get_device_name(0)}")

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
from app.gpu_utils import get_gpu_memory_info
print(get_gpu_memory_info())
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –¢–µ—Å—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
python -c "from app.services.embeddings import embed_dense; print(embed_dense('test'))"

# –¢–µ—Å—Ç reranker
python -c "from app.services.rerank import rerank; print(rerank('test', [{'payload': {'text': 'test'}}]))"

# –¢–µ—Å—Ç chunker
python -c "from ingestion.semantic_chunker import chunk_text_semantic; print(chunk_text_semantic('test text'))"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. GPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 rocm-smi

# –ò–ª–∏ —á–µ—Ä–µ–∑ nvidia-smi (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
nvidia-smi
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ API

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ GPU —á–µ—Ä–µ–∑ API
curl http://localhost:9000/v1/admin/health

# –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9000/v1/admin/metrics
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—à–∏–±–∫–∏ GPU
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–º—è—Ç–∏ GPU

```bash
# –í .env —Ñ–∞–π–ª–µ
GPU_MEMORY_FRACTION=0.8  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 80% –ø–∞–º—è—Ç–∏ GPU
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞—Ç—á–µ–π

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞
from app.gpu_utils import get_optimal_batch_size
optimal_batch = get_optimal_batch_size(model, input_shape, device)
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–æ–≤

```bash
# –î–ª—è CPU –æ–ø–µ—Ä–∞—Ü–∏–π
OMP_NUM_THREADS=4
MKL_NUM_THREADS=4
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### 1. ROCm –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
rocm-smi
# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ROCm
```

### 2. PyTorch –Ω–µ –≤–∏–¥–∏—Ç GPU

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é PyTorch
python -c "import torch; print(torch.__version__)"

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º
pip uninstall torch torchvision torchaudio
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/rocm5.7
```

### 3. –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ GPU

```bash
# –£–º–µ–Ω—å—à–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
GPU_MEMORY_FRACTION=0.6

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º CPU –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
RERANKER_DEVICE=cpu
```

### 4. –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É GPU
rocm-smi

# –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
python scripts/test_gpu_performance.py
```

## üìà –ë–µ–Ω—á–º–∞—Ä–∫–∏

### –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Radeon RX 6700 XT)

| –û–ø–µ—Ä–∞—Ü–∏—è | CPU (s) | GPU (s) | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|----------|---------|---------|-----------|
| Dense Embedding (1 —Ç–µ–∫—Å—Ç) | 0.05 | 0.02 | 2.5x |
| Dense Embedding (10 —Ç–µ–∫—Å—Ç–æ–≤) | 0.50 | 0.15 | 3.3x |
| Reranking (5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤) | 0.20 | 0.08 | 2.5x |
| Semantic Chunking | 0.30 | 0.12 | 2.5x |
| –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å | 2.00 | 0.80 | 2.5x |

### –§–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏** - –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ VRAM
2. **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏
3. **–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–π** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª—É—á—à–µ –Ω–∞ CPU
4. **–ü–∞–º—è—Ç—å GPU** - –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üöÄ –ó–∞–ø—É—Å–∫ —Å GPU

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ GPU –≤–∫–ª—é—á–µ–Ω –≤ .env
export GPU_ENABLED=true
python wsgi.py
```

### 2. –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º —Å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
python adapters/telegram_enhanced.py
```

### 3. –ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

```bash
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
python -c "from ingestion.pipeline import crawl_and_index; crawl_and_index()"
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GPU_MEMORY_FRACTION=0.6` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
- –í–∫–ª—é—á–∞–π—Ç–µ GPU —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 2. –î–ª—è production
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GPU_MEMORY_FRACTION=0.8` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ GPU
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ GPU –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π
- –ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å RAG-—Å–∏—Å—Ç–µ–º—ã:

- ‚úÖ **2-4x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** - –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

Radeon RX 6700 XT –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è RAG-—Å–∏—Å—Ç–µ–º—ã –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å! üöÄ
