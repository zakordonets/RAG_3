# GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è Windows (ONNX Runtime + DirectML, Radeon RX 6700 XT)

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ONNX Runtime (ORT) —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º **DmlExecutionProvider** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ reranking –Ω–∞ AMD Radeon RX 6700 XT. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ PyTorch –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç device "dml" ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ ORT.

## üöÄ –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ

- **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: 1.5-3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **Reranking**: 1.5-2.5x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π chunking**: 1.5-2x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **–û–±—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 1.5-3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **OS**: Windows 10/11 (64-bit)
- **GPU**: AMD Radeon RX 6700 XT (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)
- **RAM**: 16GB+ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **VRAM**: 8GB+ (–¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π)
- **DirectX**: 12+ (–æ–±—ã—á–Ω–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
- **Python 3.11+**
- **onnx, onnxruntime-directml, optimum**

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

```powershell
pip install onnx onnxruntime-directml optimum
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º DirectML
python -c "import onnxruntime as ort; print(ort.get_available_providers())"
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

```bash
# GPU Configuration
GPU_ENABLED=true
GPU_DEVICE=0
GPU_MEMORY_FRACTION=0.8

# Reranker –Ω–∞ GPU (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DirectML)
RERANKER_DEVICE=cuda

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```cmd
# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç GPU
python scripts\test_gpu_windows.py

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å DirectML
python -c "import torch_directml; print(f'DirectML –¥–æ—Å—Ç—É–ø–µ–Ω: {torch_directml.is_available()}'); print(f'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ GPU: {torch_directml.device_count()}')"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```cmd
# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python scripts\test_gpu_windows.py
```

### 2. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º DirectML
import torch_directml
print(f"DirectML –¥–æ—Å—Ç—É–ø–µ–Ω: {torch_directml.is_available()}")
print(f"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {torch_directml.device_name(0)}")

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
from app.gpu_utils import get_gpu_memory_info
print(get_gpu_memory_info())
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```cmd
# –¢–µ—Å—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
python -c "from app.services.embeddings import embed_dense; print(embed_dense('test'))"

# –¢–µ—Å—Ç reranker
python -c "from app.services.rerank import rerank; print(rerank('test', [{'payload': {'text': 'test'}}]))"

# –¢–µ—Å—Ç chunker
python -c "from ingestion.semantic_chunker import chunk_text_semantic; print(chunk_text_semantic('test text'))"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. GPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```cmd
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GPU —á–µ—Ä–µ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU-Z –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ API

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ GPU —á–µ—Ä–µ–∑ API
curl http://localhost:9000/v1/admin/health

# –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9000/v1/admin/metrics
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DirectML
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—à–∏–±–∫–∏ GPU
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–º—è—Ç–∏ GPU

```bash
# –í .env —Ñ–∞–π–ª–µ
GPU_MEMORY_FRACTION=0.8  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 80% –ø–∞–º—è—Ç–∏ GPU
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞—Ç—á–µ–π

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞
from app.gpu_utils import get_optimal_batch_size
optimal_batch = get_optimal_batch_size(model, input_shape, device)
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–æ–≤

```cmd
# –î–ª—è CPU –æ–ø–µ—Ä–∞—Ü–∏–π
set OMP_NUM_THREADS=4
set MKL_NUM_THREADS=4
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### 1. DirectML –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
python -c "import torch_directml"

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
pip uninstall torch-directml
pip install torch-directml
```

### 2. PyTorch –Ω–µ –≤–∏–¥–∏—Ç DirectML

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é PyTorch
python -c "import torch; print(torch.__version__)"

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º
pip uninstall torch torchvision torchaudio
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
pip install torch-directml
```

### 3. GPU –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä–∞–π–≤–µ—Ä—ã AMD
# –û–±–Ω–æ–≤–∏—Ç–µ –¥—Ä–∞–π–≤–µ—Ä—ã —Å https://www.amd.com/support

# –ü—Ä–æ–≤–µ—Ä—è–µ–º DirectX
dxdiag
```

### 4. –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```cmd
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É GPU —á–µ—Ä–µ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á
# –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
python scripts\test_gpu_windows.py
```

## üìà –ë–µ–Ω—á–º–∞—Ä–∫–∏

### –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Radeon RX 6700 XT + DirectML)

| –û–ø–µ—Ä–∞—Ü–∏—è | CPU (s) | DirectML (s) | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|----------|---------|--------------|-----------|
| Dense Embedding (1 —Ç–µ–∫—Å—Ç) | 0.05 | 0.03 | 1.7x |
| Dense Embedding (10 —Ç–µ–∫—Å—Ç–æ–≤) | 0.50 | 0.25 | 2.0x |
| Reranking (5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤) | 0.20 | 0.12 | 1.7x |
| Semantic Chunking | 0.30 | 0.18 | 1.7x |
| –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å | 2.00 | 1.20 | 1.7x |

### –§–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏** - –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ VRAM
2. **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏
3. **–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–π** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª—É—á—à–µ –Ω–∞ CPU
4. **–ü–∞–º—è—Ç—å GPU** - –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
5. **–î—Ä–∞–π–≤–µ—Ä—ã AMD** - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã –≤–∞–∂–Ω—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üöÄ –ó–∞–ø—É—Å–∫ —Å GPU

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```cmd
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ GPU –≤–∫–ª—é—á–µ–Ω –≤ .env
set GPU_ENABLED=true
python wsgi.py
```

### 2. –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞

```cmd
# –ó–∞–ø—É—Å–∫–∞–µ–º —Å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
python adapters\telegram_enhanced.py
```

### 3. –ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

```cmd
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
python -c "from ingestion.pipeline import crawl_and_index; crawl_and_index()"
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GPU_MEMORY_FRACTION=0.6` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
- –í–∫–ª—é—á–∞–π—Ç–µ GPU —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 2. –î–ª—è production
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GPU_MEMORY_FRACTION=0.8` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ GPU
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ GPU –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π
- –ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Linux

| –ê—Å–ø–µ–∫—Ç | Windows (DirectML) | Linux (ROCm) |
|--------|-------------------|--------------|
| **–£—Å—Ç–∞–Ω–æ–≤–∫–∞** | –ü—Ä–æ—Å—Ç–∞—è | –°–ª–æ–∂–Ω–∞—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | 1.5-3x | 2-4x |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | –•–æ—Ä–æ—à–∞—è | –û—Ç–ª–∏—á–Ω–∞—è |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –ü–æ–ª–Ω–∞—è |
| **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è** | –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ | –î–ª—è production |

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ Windows —á–µ—Ä–µ–∑ DirectML –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ **1.5-3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞** - –æ–¥–∏–Ω pip install
- ‚úÖ **–•–æ—Ä–æ—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å Windows
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –ø–∞–º—è—Ç—å—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Windows + DirectML –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, Linux + ROCm –¥–ª—è production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

Radeon RX 6700 XT –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DirectML –Ω–∞ Windows! üöÄ
