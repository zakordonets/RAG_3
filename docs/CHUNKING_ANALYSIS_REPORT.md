# üî¨ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó CHUNKING –°–¢–†–ê–¢–ï–ì–ò–ò

## üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ "One Topic Per Chunk"

**–§–∞–∫—Ç—ã:**
- –û—Ä–∏–≥–∏–Ω–∞–ª: 2398 —Å–∏–º–≤–æ–ª–æ–≤, 2 –∑–∞–≥–æ–ª–æ–≤–∫–∞ H2 (–¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã)
- –í Qdrant: **–û–î–ò–ù —á–∞–Ω–∫** —Å–æ–¥–µ—Ä–∂–∏—Ç –û–ë–ï —Ç–µ–º—ã
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ–º–∞–º–∏: **770 —Å–∏–º–≤–æ–ª–æ–≤**
- –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞: **30.8%** (–æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ 69.2%)

**–î–µ—Ç–∞–ª–∏:**
```
–û—Ä–∏–≥–∏–Ω–∞–ª –∏–º–µ–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
1. –í–≤–µ–¥–µ–Ω–∏–µ (—á—Ç–æ —Ç–∞–∫–æ–µ edna Chat Center)
2. ## –†–æ–ª–∏ –≤ edna Chat Center (—Ç–∞–±–ª–∏—Ü–∞ —Å 3 —Ä–æ–ª—è–º–∏)
3. ## –ö–∞–Ω–∞–ª—ã –≤ edna Chat Center (—Å–ø–∏—Å–æ–∫ –∏–∑ 11 –∫–∞–Ω–∞–ª–æ–≤)

–í—Å–µ –ø–æ–ø–∞–ª–æ –≤ –û–î–ò–ù —á–∞–Ω–∫!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –¥–ª—è RAG:**
1. **Diluted semantics** - —Å–µ–º–∞–Ω—Ç–∏–∫–∞ —Ä–∞–∑–º—ã—Ç–∞ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–µ–º–∞–º–∏
2. **Wrong context** - –∑–∞–ø—Ä–æ—Å "–∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã" –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç, —Å–º–µ—à–∞–Ω–Ω—ã–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø—Ä–æ —Ä–æ–ª–∏
3. **Poor ranking** - –º–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç "–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä", "—Ä–æ–ª–∏", "–∞–≥–µ–Ω—Ç—ã" –ò –¢–û–õ–¨–ö–û –ü–û–¢–û–ú "–∫–∞–Ω–∞–ª—ã"
4. **Token waste** - LLM –ø–æ–ª—É—á–∏—Ç –æ–≥—Ä–æ–º–Ω—ã–π —á–∞–Ω–∫ –≤–º–µ—Å—Ç–æ —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #2: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –≤ –Ω–∞—á–∞–ª–µ, –∞ –Ω–µ –∫–æ–Ω—Ç–µ–Ω—Ç

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
```
–ß–∞–Ω–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å: "## –ö–∞–Ω–∞–ª—ã –≤ edna Chat Center"
–ê –ù–ï —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: "–ö edna Chat Center –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å..."
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- Embedding –º–æ–¥–µ–ª—å –ø—Ä–∏–¥–∞—ë—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å –Ω–∞—á–∞–ª—É —Ç–µ–∫—Å—Ç–∞
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "## –ö–∞–Ω–∞–ª—ã" –º–µ–Ω–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω, —á–µ–º "–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞–Ω–∞–ª—ã"
- –¢–µ—Ä—è–µ—Ç—Å—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å —Å –∑–∞–ø—Ä–æ—Å–æ–º

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê #3: –ü–æ—Ç–µ—Ä—è 30% –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ß—Ç–æ –ø–æ—Ç–µ—Ä—è–ª–æ—Å—å:**
- Frontmatter (metadata): `title`, `description`, `category`
- Admonitions: `:::info`
- ContentRef —Å—Å—ã–ª–∫–∏
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: `<LastUpdatedDate>`

**–í–ª–∏—è–Ω–∏–µ:**
- –ü–æ—Ç–µ—Ä—è–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è boosting
- –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`category: start`)
- –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —É–¥–∞–ª–µ–Ω—ã

---

## üîç –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó

### –¢–µ–∫—É—â–∞—è chunking —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** (`ingestion/config.yaml`)
```yaml
chunk:
  max_tokens: 600  # ~2400 —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 1:4
  min_tokens: 350  # ~1400 —Å–∏–º–≤–æ–ª–æ–≤
  overlap_base: 100
```

**–ü—Ä–æ–±–ª–µ–º—ã –ø–æ–¥—Ö–æ–¥–∞:**
1. ‚úÖ Token-based chunking - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
2. ‚ùå –ù–û: –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞** (H2 —Ä–∞–∑–¥–µ–ª—ã)
3. ‚ùå –ù–û: –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å**
4. ‚ùå –ù–û: —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π `max_tokens` –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

### –ü–æ—á–µ–º—É –æ–¥–∏–Ω —á–∞–Ω–∫ –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö?

**–ê–Ω–∞–ª–∏–∑:**
- –§–∞–π–ª: 2398 —Å–∏–º–≤–æ–ª–æ–≤ ‚âà **600 —Ç–æ–∫–µ–Ω–æ–≤** (–ø—Ä–∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–µ 1:4)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞: `max_tokens: 600`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: **–í–ï–°–¨ —Ñ–∞–π–ª –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ª–∏–º–∏—Ç!**

**–í—ã–≤–æ–¥:** Chunker —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–ª –∏ –Ω–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –µ–≥–æ.

---

## üéØ –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ chunking

**–¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥:**
```
Chunker —Å–º–æ—Ç—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
- –ì—Ä–∞–Ω–∏—Ü—ã –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
```

**–ß–µ–≥–æ –ù–ï –¥–µ–ª–∞–µ—Ç:**
```
‚úó –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ H2/H3 –∫–∞–∫ –≥—Ä–∞–Ω–∏—Ü—ã —Ç–µ–º
‚úó –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç, —á—Ç–æ "## –†–æ–ª–∏" –∏ "## –ö–∞–Ω–∞–ª—ã" - —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã
‚úó –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
```

---

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å "one size fits all" –ø–æ–¥—Ö–æ–¥–æ–º

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
```
max_tokens = 600 –¥–ª—è –í–°–ï–• –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö–æ—Ä–æ—Ç–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (2398 —Å–∏–º–≤) ‚Üí 1 —á–∞–Ω–∫ ‚Üí —Å–º–µ—à–∞–Ω–Ω—ã–µ —Ç–µ–º—ã ‚ùå
- –î–ª–∏–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (10000 —Å–∏–º–≤) ‚Üí 5 —á–∞–Ω–∫–æ–≤ ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º ‚úÖ
- –î–æ–∫—É–º–µ–Ω—Ç —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ ‚Üí –ø–ª–æ—Ö–æ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è ‚ùå

---

### 3. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ Document Structure Signals

**–ß—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è:**
- `H2` –∑–∞–≥–æ–ª–æ–≤–∫–∏ = **—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã**
- `–¢–∞–±–ª–∏—Ü—ã` = –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
- `–°–ø–∏—Å–∫–∏` = –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (–∫–∞–Ω–∞–ª—ã, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- `:::info` admonitions = –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
```
H2 ‚Üí –ù–û–í–´–ô –ß–ê–ù–ö (–µ—Å–ª–∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π)
–¢–∞–±–ª–∏—Ü–∞ ‚Üí –û—Ç–¥–µ–ª—å–Ω—ã–π —á–∞–Ω–∫ –ò–õ–ò —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–∞
–°–ø–∏—Å–æ–∫ ‚Üí –î–µ—Ä–∂–∞—Ç—å –≤–º–µ—Å—Ç–µ, –Ω–µ —Ä–∞–∑–±–∏–≤–∞—Ç—å –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ
```

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–û–±—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã)

### 1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Chunking

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```python
1. Parse –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –±–ª–æ–∫–∏:
   - H2/H3 —Å–µ–∫—Ü–∏–∏
   - –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã
   - –¢–∞–±–ª–∏—Ü—ã
   - –°–ø–∏—Å–∫–∏

2. –î–ª—è –∫–∞–∂–¥–æ–π H2 —Å–µ–∫—Ü–∏–∏:
   IF tokens(—Å–µ–∫—Ü–∏—è) < max_tokens:
       —Å–µ–∫—Ü–∏—è = –æ–¥–∏–Ω —á–∞–Ω–∫
   ELSE:
       —Ä–∞–∑–±–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–∏ –ø–æ H3 –ò–õ–ò –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º

3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç:
   chunk.metadata = {
       "section": "–ö–∞–Ω–∞–ª—ã –≤ edna Chat Center",
       "parent_section": "–ß—Ç–æ —Ç–∞–∫–æ–µ edna Chat Center"
   }
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ = –æ–¥–Ω–∞ —Ç–µ–º–∞
- –í—ã—Å–æ–∫–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –õ—É—á—à–∏–π ranking –≤ –ø–æ–∏—Å–∫–µ

---

### 2. ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —á–∞–Ω–∫–æ–≤

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
```python
IF document_has_clear_sections(H2_count >= 2):
    chunk_by_sections()
    max_tokens = 400  # –ú–µ–Ω—å—à–µ, —á—Ç–æ–±—ã —Å–µ–∫—Ü–∏–∏ –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è–ª–∏—Å—å
ELSE:
    chunk_by_paragraphs()
    max_tokens = 600  # –ú–æ–∂–Ω–æ –±–æ–ª—å—à–µ
```

**–î–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è:**
```yaml
# –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–∫—Ü–∏—è–º–∏ (H2 >= 2)
chunk:
  max_tokens: 350  # –ó–∞—Å—Ç–∞–≤–∏—Ç —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 2 —á–∞–Ω–∫–∞
  respect_headings: true  # –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
  heading_levels: [2]  # H2 = –≥—Ä–∞–Ω–∏—Ü–∞ —á–∞–Ω–∫–∞
```

---

### 3. ‚úÖ Semantic Coherence Check

**–ò–¥–µ—è:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —á–∞–Ω–∫ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω

```python
def check_coherence(chunk_text):
    embeddings = []
    for paragraph in chunk_text.split('\n\n'):
        embeddings.append(embed(paragraph))

    coherence = cosine_similarity(embeddings)

    if coherence < threshold:
        # –†–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞–Ω–∫–æ–≤
        split_chunk()
```

---

### 4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ payload:**
```python
payload = {
    "text": chunk_text,
    "title": "–ß—Ç–æ —Ç–∞–∫–æ–µ edna Chat Center",
    "section_title": "–ö–∞–Ω–∞–ª—ã –≤ edna Chat Center",  # ‚Üê –í–∞–∂–Ω–æ!
    "section_type": "list",  # paragraph | table | list
    "has_h2": True,
    "list_items_count": 11,  # –î–ª—è —Å–ø–∏—Å–∫–æ–≤ –∫–∞–Ω–∞–ª–æ–≤
    "keywords": ["–∫–∞–Ω–∞–ª", "–ø–æ–¥–∫–ª—é—á–∏—Ç—å", "whatsapp", "telegram"]  # ‚Üê –î–ª—è boosting!
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í boost_score():
if "–∫–∞–Ω–∞–ª" in payload.get("keywords", []):
    if "–∫–∞–Ω–∞–ª" in query:
        s *= 2.0  # –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–µ–º—ã
```

---

### 5. ‚úÖ Hierarchical Chunking

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** –°–æ–∑–¥–∞–≤–∞—Ç—å —á–∞–Ω–∫–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö

```
Document: "–ß—Ç–æ —Ç–∞–∫–æ–µ edna Chat Center"
  ‚îú‚îÄ Chunk 0 (summary): "edna Chat Center ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ..."
  ‚îú‚îÄ Chunk 1 (section): "–†–æ–ª–∏ –≤ edna Chat Center: –ê–≥–µ–Ω—Ç, –°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä..."
  ‚îî‚îÄ Chunk 2 (section): "–ö–∞–Ω–∞–ª—ã: WhatsApp, Telegram, Viber..."

–ü—Ä–∏ –ø–æ–∏—Å–∫–µ:
  - –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Å–µ–∫—Ü–∏—é (Chunk 1 –∏–ª–∏ 2)
  - –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç, –¥–æ–±–∞–≤–∏—Ç—å Chunk 0
```

---

## üìê –ö–û–ù–ö–†–ï–¢–ù–´–ï –¶–ò–§–†–´

### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –≤–∞—à–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ê–Ω–∞–ª–∏–∑:**
- –°—Ä–µ–¥–Ω–∏–π H2 —Ä–∞–∑–¥–µ–ª: 300-800 —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ: 50-150 —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ä–µ–¥–Ω–∏–π —Å–ø–∏—Å–æ–∫: 100-200 —Ç–æ–∫–µ–Ω–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```yaml
chunk:
  max_tokens: 400  # ‚Üê –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ!
  min_tokens: 150  # –ú–∏–Ω–∏–º—É–º –¥–ª—è –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–≥–æ —á–∞–Ω–∫–∞
  overlap_base: 50  # –ú–µ–Ω—å—à–µ overlap –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

  # –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ)
  respect_h2_boundaries: true
  split_large_tables: false
  keep_lists_together: true
```

---

## üé¨ –ß–¢–û –ò–ó–ú–ï–ù–ò–¢–°–Ø

### –î–æ (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):
```
–§–∞–π–ª whatis.md (2398 —Å–∏–º–≤–æ–ª–æ–≤)
  ‚îî‚îÄ –ß–∞–Ω–∫ 1: [–†–æ–ª–∏ + –ö–∞–Ω–∞–ª—ã –≤–º–µ—Å—Ç–µ]
     Score: 0.0049 (–ø–æ–∑–∏—Ü–∏—è #26)
```

### –ü–æ—Å–ª–µ (—Å max_tokens=400):
```
–§–∞–π–ª whatis.md (2398 —Å–∏–º–≤–æ–ª–æ–≤)
  ‚îú‚îÄ –ß–∞–Ω–∫ 1: [–í–≤–µ–¥–µ–Ω–∏–µ + –†–æ–ª–∏]
  ‚îÇ  "edna Chat Center ‚Äî —Ä–µ—à–µ–Ω–∏–µ... –†–æ–ª–∏: –ê–≥–µ–Ω—Ç, –°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä..."
  ‚îÇ
  ‚îî‚îÄ –ß–∞–Ω–∫ 2: [–ö–∞–Ω–∞–ª—ã]  ‚Üê –≠–¢–û–¢ –Ω–∞–π–¥—ë—Ç—Å—è!
     "–ö edna Chat Center –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å: WhatsApp, Telegram..."
     Score: 0.05+ (–ø–æ–∑–∏—Ü–∏—è #1-5)
```

---

## üö´ –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨

### ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ—Å—Ç—ã–ª–∏:
- Boosting –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- Keyword matching –¥–ª—è "–∫–∞–Ω–∞–ª"
- Hardcoded –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è /start/

### ‚ùå –°–ª–∏—à–∫–æ–º –º–µ–ª–∫–∏–µ —á–∞–Ω–∫–∏:
- `max_tokens < 150` ‚Üí –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ö–∞–∂–¥—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ = —á–∞–Ω–∫ ‚Üí too granular

### ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- "–ü—Ä–æ—Å—Ç–æ —É–º–µ–Ω—å—à–∏–º —Ç–æ–∫–µ–Ω—ã" –±–µ–∑ —É—á—ë—Ç–∞ H2
- –†–∞–∑–±–∏–≤–∫–∞ —Å–ø–∏—Å–∫–æ–≤ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ

---

## üéØ –ò–¢–û–ì–û–í–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### Immediate Fix (–±—ã—Å—Ç—Ä–æ, 80% —ç—Ñ—Ñ–µ–∫—Ç–∞):
```yaml
# ingestion/config.yaml
chunk:
  max_tokens: 350  # –ë—ã–ª–æ 600
  min_tokens: 150  # –ë—ã–ª–æ 350
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: –§–∞–π–ª —Ä–∞–∑–æ–±—å—ë—Ç—Å—è –Ω–∞ 2-3 —á–∞–Ω–∫–∞ –ø–æ —Å–µ–∫—Ü–∏—è–º

### Long-term Solution (–ø—Ä–∞–≤–∏–ª—å–Ω–æ, 100% —ç—Ñ—Ñ–µ–∫—Ç–∞):
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **structure-aware chunking**
2. –î–æ–±–∞–≤–∏—Ç—å **section_title** –≤ metadata
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **hierarchical chunks**
4. –î–æ–±–∞–≤–∏—Ç—å **keywords extraction** –¥–ª—è boosting

---

## üìà EXPECTED IMPACT

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –¢–µ–∫—É—â–∏–π Score: 0.0049 (–ø–æ–∑–∏—Ü–∏—è #26)
- **–ü–æ—Å–ª–µ chunking fix: ~0.05-0.08 (–ø–æ–∑–∏—Ü–∏—è #1-5)** ‚úÖ
- –¢–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤: +40%
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: +60%

**–ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –í–°–ï–• –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –Ω–µ —Ç–æ–ª—å–∫–æ whatis
- ‚úÖ –£–ª—É—á—à–∏—Ç –ø–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫–∞–º, —Ç–∞–±–ª–∏—Ü–∞–º, —Å–µ–∫—Ü–∏—è–º
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

**–ê–≤—Ç–æ—Ä:** RAG System Analysis
**–î–∞—Ç–∞:** 2025-10-08
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
